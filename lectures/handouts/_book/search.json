[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "量化投资课程讲义",
    "section": "",
    "text": "本讲义将系统地介绍量化投资的基本概念、理论框架、常用策略以及实践应用。\n引言:\n量化投资是指利用数学、统计学和计算机科学等定量方法，对金融市场进行分析和预测，以实现投资目标的一种投资方式。量化投资是学术界和业界广泛关注的一个研究领域。在学术界，量化投资理论研究主要集中在资产定价理论、投资组合理论、风险管理理论等方面。在业界，量化投资主要集中在量化选股、量化择时、量化对冲、算法交易等领域。由于课程时间有限，本讲义将主要介绍基于实证资产定价理论的量化投资方法，对实际案例的讲解偏向量化选股。\n课程内容（理论）:\n\n有效市场假说 (EMH)\n资本资产定价模型 (CAPM)\n三因子模型\n\n课程内容（实践）:\n\nCAPM实证检验\n三因子模型实证检验\n\n课程项目:\n\n传统多因子投资\n机器学习与另类数据\n\n使用说明:\n\n本讲义使用 Quarto 创建，可以方便地生成 HTML, PDF, ePub 等多种格式。\n点击左侧导航栏可以浏览不同章节的内容。\n\n希望本讲义能帮助您更好地学习和理解量化投资！",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>前言</span>"
    ]
  },
  {
    "objectID": "01_emh.html",
    "href": "01_emh.html",
    "title": "2  有效市场假说 (EMH)",
    "section": "",
    "text": "2.1 本节课主要内容",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>有效市场假说 (EMH)</span>"
    ]
  },
  {
    "objectID": "01_emh.html#本节课主要内容",
    "href": "01_emh.html#本节课主要内容",
    "title": "2  有效市场假说 (EMH)",
    "section": "",
    "text": "什么是有效市场假说 (EMH)?\nEMH 的三个层次\nEMH 与量化投资的关联",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>有效市场假说 (EMH)</span>"
    ]
  },
  {
    "objectID": "01_emh.html#什么是有效市场假说-emh",
    "href": "01_emh.html#什么是有效市场假说-emh",
    "title": "2  有效市场假说 (EMH)",
    "section": "2.2 什么是有效市场假说 (EMH)?",
    "text": "2.2 什么是有效市场假说 (EMH)?\n有效市场假说 (Efficient Market Hypothesis, EMH) 是金融学中一个核心理论，它认为资产价格完全反映了所有可获得的信息。这意味着在有效市场中：\n\n价格反应迅速: 一旦新的信息出现，价格会立即调整到新的均衡水平。\n无法持续跑赢市场: 由于价格已经反映了所有信息，投资者无法通过分析信息来持续获得超额收益 (alpha)。\n随机游走: 价格变动是随机的，遵循随机游走 (random walk) 模式，过去的价格信息无法预测未来的价格。",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>有效市场假说 (EMH)</span>"
    ]
  },
  {
    "objectID": "01_emh.html#emh-的三个层次",
    "href": "01_emh.html#emh-的三个层次",
    "title": "2  有效市场假说 (EMH)",
    "section": "2.3 EMH 的三个层次",
    "text": "2.3 EMH 的三个层次\nEMH 通常被分为三个层次，根据市场有效性的程度递增：\n\n弱式有效市场 (Weak-form Efficiency):\n\n价格已完全反映了历史价格信息。\n技术分析 (Technical Analysis) 无效，因为历史价格模式无法预测未来价格。\n基本面分析 (Fundamental Analysis) 可能有效。\n\n半强式有效市场 (Semi-strong-form Efficiency):\n\n价格已完全反映了所有公开信息，包括财务报表、新闻、经济数据等。\n技术分析和基于公开信息的基本面分析都无效。\n只有内幕信息 (Insider Information) 可能获得超额收益 (但违法)。\n\n强式有效市场 (Strong-form Efficiency):\n\n价格已完全反映了所有信息，包括公开信息和内幕信息。\n任何信息都无法用来获得超额收益，包括内幕信息。\n强式有效市场在现实中极少存在。",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>有效市场假说 (EMH)</span>"
    ]
  },
  {
    "objectID": "01_emh.html#emh-与量化投资的关联",
    "href": "01_emh.html#emh-与量化投资的关联",
    "title": "2  有效市场假说 (EMH)",
    "section": "2.4 EMH 与量化投资的关联",
    "text": "2.4 EMH 与量化投资的关联\nEMH 对量化投资 (Quantitative Investing) 有着深刻的影响，但也并非完全否定量化投资的价值。\n\n2.4.1 EMH 对量化投资的挑战\n\nAlpha 的获取难度: EMH 认为市场难以被持续战胜，量化投资的核心目标是寻找 alpha (超额收益)，这在有效市场中变得非常困难。\n模型失效风险: 如果市场是有效的，那么基于历史数据构建的模型可能会迅速失效，因为市场会吸收并反映这些模型所利用的信息。\n交易成本: 量化投资通常涉及高频交易和大量交易，在有效市场中，频繁交易可能被交易成本抵消收益。\n\n\n\n2.4.2 量化投资在有效市场中的机会\n\n市场并非完全有效: 尽管 EMH 是一个重要的理论，但现实市场并非完全有效，存在各种市场摩擦和行为偏差，为量化投资提供了机会。\n挖掘微弱的 Alpha: 量化投资可以通过精细的模型和算法，挖掘市场中微弱的、短暂的 alpha 机会。\n风险管理: 量化投资在风险管理方面具有优势，可以通过模型化方法更有效地控制投资组合的风险。\n交易效率: 量化交易系统可以实现自动化交易，提高交易效率，降低人为错误。\n另类数据: 量化投资可以利用另类数据 (Alternative Data)，例如社交媒体数据、卫星图像数据等，来寻找新的信息来源和投资机会。",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>有效市场假说 (EMH)</span>"
    ]
  },
  {
    "objectID": "01_emh.html#总结",
    "href": "01_emh.html#总结",
    "title": "2  有效市场假说 (EMH)",
    "section": "2.5 总结",
    "text": "2.5 总结\n\n有效市场假说 (EMH) 是金融学的重要理论，强调市场价格的信息效率。\nEMH 分为弱式、半强式和强式三个层次。\nEMH 对量化投资提出了挑战，但也为量化投资提供了在市场非完全有效性、风险管理、交易效率和另类数据利用等方面的机会。\n量化投资需要在 EMH 的框架下，不断探索新的模型和策略，以适应不断变化的市场环境。",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>有效市场假说 (EMH)</span>"
    ]
  },
  {
    "objectID": "02_capm.html",
    "href": "02_capm.html",
    "title": "3  资本资产定价模型 (CAPM)",
    "section": "",
    "text": "3.1 本节课主要内容",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>资本资产定价模型 (CAPM)</span>"
    ]
  },
  {
    "objectID": "02_capm.html#本节课主要内容",
    "href": "02_capm.html#本节课主要内容",
    "title": "3  资本资产定价模型 (CAPM)",
    "section": "",
    "text": "CAPM 模型的理论基础: 理解 CAPM 模型的核心假设和理论逻辑。\nCAPM 模型的推导过程: 掌握从投资组合理论到 CAPM 模型的推导过程。\nCAPM 模型的经济学解释: 理解 Beta 系数的经济含义，以及风险溢价的概念。\nCAPM 模型的实证检验: 学习 CAPM 模型的常用实证检验方法，并了解在中国市场的检验结果。\n实践：使用 Python 计算个股 Beta 值: 掌握使用 Python 计算 Beta 值的方法。\nCAPM 模型的局限性: 认识 CAPM 模型在实际应用中的局限性。",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>资本资产定价模型 (CAPM)</span>"
    ]
  },
  {
    "objectID": "02_capm.html#capm-模型的理论基础",
    "href": "02_capm.html#capm-模型的理论基础",
    "title": "3  资本资产定价模型 (CAPM)",
    "section": "3.2 CAPM 模型的理论基础",
    "text": "3.2 CAPM 模型的理论基础\n\n3.2.1 为什么要学习 CAPM 模型？\n\n现代金融理论的基石: CAPM 模型是现代金融理论的起点，理解 CAPM 是学习更高级模型的必要基础。\n风险与收益的定价模型: CAPM 模型提供了一个简洁的框架，用于理解风险和预期收益之间的关系，是资产定价的核心模型之一。\n投资决策的重要工具: CAPM 模型可以帮助投资者评估资产的合理收益率，进行投资组合管理和绩效评估。\n学术研究和实践应用的广泛性: CAPM 模型在学术研究和投资实践中都得到了广泛的应用，是金融领域从业人员必备的知识。\n\n\n\n3.2.2 CAPM 模型的核心假设\nCAPM 模型建立在一系列理想化的假设之上，理解这些假设是理解模型适用范围和局限性的关键。\n\n投资者是风险厌恶的，追求效用最大化:\n\n投资者在给定的收益水平下，偏好风险较低的投资；在给定的风险水平下，偏好收益较高的投资。\n投资者进行投资决策的目标是最大化其期望效用，而非仅仅是期望收益。\n\n市场是完美的:\n\n无交易成本: 买卖资产不存在任何交易费用，如佣金、税费等。\n信息对称: 所有投资者都可以免费、及时地获得所有相关信息。\n完全可分: 资产可以被无限分割，投资者可以买卖任意数量的资产。\n无卖空限制: 投资者可以无限制地卖空任何资产。\n\n存在无风险利率，投资者可以无限制地借贷:\n\n存在一个无风险利率 \\(R_f\\)，投资者可以以该利率无限制地借入或贷出资金。\n这意味着投资者可以自由地调整投资组合的风险水平。\n\n所有投资者持有相同的投资期限:\n\n所有投资者的投资期限都是相同的，例如都为一个月、一年等。\n这简化了模型分析，使得我们可以关注单期投资决策。\n\n资产收益率服从正态分布:\n\n所有资产的收益率都服从正态分布。\n正态分布的假设使得我们可以用均值和方差来完整描述收益率的分布特征，简化了风险的度量。\n\n\n\n\n3.2.3 核心假设的解读\n\n理想化假设 vs. 现实: CAPM 模型的假设在现实市场中很难完全成立，例如交易成本是存在的，信息也不是完全对称的。\n模型简化与权衡: 这些假设是对现实的简化，目的是为了构建一个简洁、易于分析的模型。模型的价值在于提供了一个理解资产定价的基本框架，而不是完美地预测现实。\n后续模型的拓展: 后续的资产定价模型，如 Fama-French 三因子模型、行为金融学模型等，都是在放松 CAPM 模型某些假设的基础上发展起来的。",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>资本资产定价模型 (CAPM)</span>"
    ]
  },
  {
    "objectID": "02_capm.html#capm-模型的推导过程",
    "href": "02_capm.html#capm-模型的推导过程",
    "title": "3  资本资产定价模型 (CAPM)",
    "section": "3.3 CAPM 模型的推导过程",
    "text": "3.3 CAPM 模型的推导过程\n\n3.3.1 投资组合理论回顾：均值-方差分析框架\nCAPM 模型的推导基础是马科维茨的投资组合理论，我们首先回顾一下均值-方差分析框架。\n\n期望收益率:\n\n投资组合的期望收益率是组合中各资产期望收益率的加权平均： \\(E(R_p) = \\sum_{i=1}^n w_i E(R_i)\\) 其中，\\(w_i\\) 是资产 \\(i\\) 在组合中的权重，\\(E(R_i)\\) 是资产 \\(i\\) 的期望收益率。\n\n组合方差:\n\n组合的方差（衡量风险）不仅取决于各资产的方差，还取决于资产之间的协方差： \\(\\sigma_p^2 = \\sum_{i=1}^n \\sum_{j=1}^n w_i w_j \\sigma_{ij}\\) 其中，\\(\\sigma_{ij}\\) 是资产 \\(i\\) 和资产 \\(j\\) 收益率之间的协方差。\n\n有效前沿:\n\n在均值-方差框架下，理性投资者会追求有效前沿上的投资组合。\n有效前沿是指在给定风险水平下，能够获得最高期望收益率的投资组合的集合；或者在给定期望收益率水平下，能够实现最低风险的投资组合的集合。\n\n\n\n\n3.3.2 引入无风险资产：资本市场线 (CML)\nCAPM 模型在投资组合理论的基础上，进一步引入了无风险资产，并假设所有投资者都持有相同的有效前沿。\n\n无风险资产的特性:\n\n期望收益率：\\(E(R_f) = R_f\\) （无风险利率）\n标准差：\\(\\sigma_f = 0\\) （无风险）\n与任何风险资产的协方差：\\(\\sigma_{if} = 0\\)\n\n资本市场线 (CML) 的推导:\n\n当引入无风险资产后，投资者可以将资金投资于无风险资产和市场组合 \\(M\\) 的线性组合。\n市场组合 \\(M\\) 是所有风险资产的组合，其权重与各资产的总市值成比例。（在 CAPM 模型中，市场组合本身位于有效前沿上）\n资本市场线 (CML) 描述了有效前沿从原来的曲线变为一条直线： \\(E(R_p) = R_f + \\frac{E(R_m) - R_f}{\\sigma_m} \\sigma_p\\) 其中，\\(E(R_m)\\) 和 \\(\\sigma_m\\) 分别是市场组合 \\(M\\) 的期望收益率和标准差。\n\nCML 的经济含义:\n\nCML 表示在有效市场中，投资者可以通过配置无风险资产和市场组合来获得任何风险水平下的最优风险收益组合。\nCML 的斜率 \\(\\frac{E(R_m) - R_f}{\\sigma_m}\\) 被称为市场风险溢价的风险价格，表示每单位风险 (标准差) 可以获得的超额收益。\n\n\n\n\n3.3.3 证券市场线 (SML) 的推导：CAPM 模型的核心\nCML 描述的是有效组合的定价关系，而 证券市场线 (SML) 则进一步给出了单个资产的期望收益率与风险之间的关系，这就是 CAPM 模型的核心。\n\n系统性风险与非系统性风险:\n\n总风险 (Total Risk)：可以用标准差 \\(\\sigma_i\\) 来衡量。\n系统性风险 (Systematic Risk)：也称为市场风险、不可分散风险，是指影响所有资产的共同风险因素，如宏观经济因素、政策变化等。\n非系统性风险 (Unsystematic Risk)：也称为特异风险、可分散风险，是指只影响个别资产的风险因素，如公司管理、行业竞争等。\n\nBeta 系数：系统性风险的度量:\n\n在 CAPM 模型中，Beta 系数 (\\(\\beta_i\\)) 被用来衡量资产 \\(i\\) 的系统性风险。\n\\(\\beta_i\\) 定义为资产 \\(i\\) 收益率与市场组合收益率的协方差，除以市场组合收益率的方差： \\(\\beta_i = \\frac{Cov(R_i, R_m)}{Var(R_m)}\\)\n\\(\\beta_i\\) 衡量了资产 \\(i\\) 的收益率对市场组合收益率变化的敏感程度。\n\n\\(\\beta_i &gt; 1\\): 资产 \\(i\\) 的波动性比市场组合更大，系统性风险较高。\n\\(\\beta_i = 1\\): 资产 \\(i\\) 的波动性与市场组合同步。\n\\(\\beta_i &lt; 1\\): 资产 \\(i\\) 的波动性比市场组合更小，系统性风险较低。\n\\(\\beta_i &lt; 0\\): 资产 \\(i\\) 与市场组合的变动方向相反，可以对冲市场风险。\n\n\n证券市场线 (SML) 的公式:\n\nCAPM 模型的核心公式，描述了单个资产的期望收益率与 Beta 系数之间的线性关系： \\(E(R_i) = R_f + \\beta_i[E(R_m) - R_f]\\)\n其中：\n\n\\(E(R_i)\\)：资产 \\(i\\) 的期望收益率\n\\(R_f\\)：无风险利率\n\\(\\beta_i\\)：资产 \\(i\\) 的 Beta 系数\n\\(E(R_m)\\)：市场组合的期望收益率\n\\([E(R_m) - R_f]\\)：市场风险溢价 (Market Risk Premium)，是投资者投资于市场组合相对于无风险资产所要求的超额收益。\n\n\nSML 的经济含义:\n\nSML 表明，在 CAPM 模型下，只有系统性风险才会被定价，非系统性风险可以通过分散化投资消除，因此投资者不需要为非系统性风险支付风险溢价。\n资产的期望收益率只与其系统性风险 (\\(\\beta_i\\)) 有关，\\(\\beta_i\\) 越高，期望收益率越高。\nSML 为资产定价提供了一个基准，可以用来评估资产的价值是否被高估或低估。",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>资本资产定价模型 (CAPM)</span>"
    ]
  },
  {
    "objectID": "02_capm.html#beta-系数的计算与经济学解释",
    "href": "02_capm.html#beta-系数的计算与经济学解释",
    "title": "3  资本资产定价模型 (CAPM)",
    "section": "3.4 Beta 系数的计算与经济学解释",
    "text": "3.4 Beta 系数的计算与经济学解释\n\n3.4.1 Beta 系数的计算方法\n\n定义法:\n\n根据 Beta 系数的定义公式直接计算： \\(\\beta_i = \\frac{Cov(R_i, R_m)}{Var(R_m)}\\)\n需要计算资产 \\(i\\) 和市场组合 \\(m\\) 的收益率序列，然后计算协方差和方差。\n\n回归方法:\n\n更常用的方法是通过回归模型估计 Beta 系数。\n市场模型 (Market Model)： \\(R_{i,t} = \\alpha_i + \\beta_i R_{m,t} + \\epsilon_{i,t}\\) 其中，\\(R_{i,t}\\) 和 \\(R_{m,t}\\) 分别是资产 \\(i\\) 和市场组合在 \\(t\\) 期的收益率，\\(\\epsilon_{i,t}\\) 是残差项。 通过对市场模型进行回归，可以得到 \\(\\beta_i\\) 的估计值。\n超额收益率形式: 为了更符合 CAPM 模型的形式，也可以使用超额收益率进行回归： \\(R_{i,t} - R_{f,t} = \\alpha_i + \\beta_i(R_{m,t} - R_{f,t}) + \\epsilon_{i,t}\\) 其中，\\(R_{f,t}\\) 是 \\(t\\) 期的无风险利率，\\(R_{i,t} - R_{f,t}\\) 和 \\(R_{m,t} - R_{f,t}\\) 分别是资产 \\(i\\) 和市场组合的超额收益率。 在这种形式下，回归得到的 \\(\\alpha_i\\) 可以被解释为 Jensen’s alpha，衡量资产的超额收益，如果 CAPM 模型完全成立，\\(\\alpha_i\\) 应该为零。\n\n\n\n\n3.4.2 3.2 Beta 系数的经济学解释\n\nBeta 值的含义:\n\n\\(\\beta_i\\) 反映了资产 \\(i\\) 对市场整体风险的敏感程度，是衡量系统性风险的重要指标。\n不同 Beta 值的股票具有不同的风险特征：\n\n高 Beta 股票 (\\(\\beta_i &gt; 1\\))：\n\n收益率波动幅度大于市场平均水平，市场上涨时涨幅更大，市场下跌时跌幅也更大。\n风险较高，但也可能带来更高的潜在收益。\n例如：科技股、成长股等。\n\n市场同步股票 (\\(\\beta_i = 1\\))：\n\n收益率波动与市场平均水平一致。\n风险收益特征与市场组合相似。\n例如：指数基金。\n\n低 Beta 股票 (\\(\\beta_i &lt; 1\\))：\n\n收益率波动幅度小于市场平均水平，市场上涨时涨幅较小，市场下跌时跌幅也较小。\n风险较低，收益也相对稳定。\n例如：公用事业股、消费必需品股等。\n\n负 Beta 股票 (\\(\\beta_i &lt; 0\\))：\n\n收益率与市场变动方向相反，市场上涨时可能下跌，市场下跌时可能上涨。\n可以作为投资组合的对冲工具，降低整体风险。\n例如：黄金等避险资产（在某些特定时期）。\n\n\n\nBeta 与风险溢价:\n\nCAPM 模型表明，投资者因承担系统性风险而获得风险溢价，Beta 系数越高，要求的风险溢价越高。\n风险溢价 \\([E(R_m) - R_f]\\) 是对所有资产共同的，而 \\(\\beta_i\\) 则是个别资产的风险承担量。\n投资者可以通过选择不同 Beta 值的资产来调整投资组合的风险和收益水平。",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>资本资产定价模型 (CAPM)</span>"
    ]
  },
  {
    "objectID": "02_capm.html#capm-模型的实证检验",
    "href": "02_capm.html#capm-模型的实证检验",
    "title": "3  资本资产定价模型 (CAPM)",
    "section": "3.5 CAPM 模型的实证检验",
    "text": "3.5 CAPM 模型的实证检验\n\n3.5.1 实证检验方法回顾\nCAPM 模型的常用实证检验方法如下：\n\n横截面回归 (Cross-Sectional Regression或Two-Pass Regression)\n\n检验股票的平均收益率是否与其 Beta 系数线性相关，\\(\\gamma_{0,t}\\) 是否接近无风险利率，\\(\\gamma_{1,t}\\) 是否等于市场风险溢价且显著为正。\n步骤：\n\n第一步 - 时间序列回归估计Beta：使用一段固定时间窗口(如过去60个月)对每个资产进行时间序列回归，估计单一Beta值 \\(\\hat{\\beta}_i\\)。 公式: \\(R_{i,t} - R_{f,t} = \\alpha_i + \\beta_i (R_{m,t} - R_{f,t}) + \\epsilon_{i,t}\\)\n第二步 - 横截面回归：在每个时间点t，使用所有资产的收益率与第一步估计的Beta值进行横截面回归。 公式: \\(R_{i,t} = \\gamma_{0,t} + \\gamma_{1,t} \\hat{\\beta}_i + \\eta_{i,t}\\)\n\n\nFama-MacBeth 回归 (Fama-MacBeth Regression)\n\n改进的横截面回归方法，处理 Beta 估计误差，提供更稳健的风险溢价估计。\n步骤：\n\n第一步 - 滚动窗口估计Beta时间序列：对每个资产使用滚动时间窗口估计Beta值 \\(\\hat{\\beta}_{i,t-1}\\)，得到Beta的时间序列。\n第二步 - 每期横截面回归：在每个时间点t，使用当期收益率与上期估计的Beta值进行横截面回归。 公式: \\(R_{i,t} = \\gamma_{0,t} + \\gamma_{1,t} \\hat{\\beta}_{i,t-1} + \\eta_{i,t}\\)\n第三步 - 计算平均风险溢价：计算所有时期横截面回归系数的时间序列平均值。 公式: \\(\\bar{\\gamma}_0 = \\frac{1}{T} \\sum_{t=1}^T \\gamma_{0,t}\\) 和 \\(\\bar{\\gamma}_1 = \\frac{1}{T} \\sum_{t=1}^T \\gamma_{1,t}\\)\n第四步 - 检验显著性：使用时间序列平均值的t统计量检验 \\(\\bar{\\gamma}_0\\) 和 \\(\\bar{\\gamma}_1\\) 的显著性。\n\n\n投资组合分组法 (Portfolio Grouping)\n\n为解决个股Beta估计误差大的问题，研究者经常采用投资组合分组法进行实证检验。\n步骤：\n\n第一步 - 估计个股Beta值：对每个股票估计Beta值。\n第二步 - 按Beta大小分组：根据Beta大小将股票分成多个投资组合(通常是10个或20个)。\n第三步 - 计算组合特征：计算每个投资组合的平均Beta和平均收益率。\n第四步 - 组合级别回归：使用投资组合的平均Beta和平均收益率进行横截面回归。 公式: \\(\\overline{R}_{p} = \\gamma_0 + \\gamma_1\\overline{\\beta}_p + \\eta_p\\)\n\n这种方法最早由Black, Jensen, and Scholes (1972)提出，能够显著减少Beta估计误差对检验结果的影响。\n\n\n\n\n3.5.2 中国市场上的 CAPM 检验\n结合参考书籍《因子投资：方法与实践》的内容，我们可以推断 CAPM 模型在中国市场上的检验结果和特点：\n\n市场因子仍然重要: 即使在中国 A 股市场，市场因子仍然是解释资产收益率的重要因素，CAPM 模型在一定程度上适用。\n定价误差可能较大: 由于中国市场新兴市场特征，有效性相对较低，市场摩擦较多，CAPM 模型可能存在较大的定价误差 (\\(\\alpha_i\\) 显著异于零)。\n需要考虑其他因子: 单因子 CAPM 模型可能不足以充分解释中国市场的资产定价现象，需要考虑加入其他风险因子，如规模、价值、盈利等，构建多因子模型。\n检验方法选择: Fama-MacBeth 回归等更稳健的方法可能更适合中国市场，以处理 Beta 估计的误差和市场噪音。\n\n\n\n3.5.3 中国市场 CAPM 实证研究的发现\n\nCAPM 在中国市场有一定解释力，但不如成熟市场: 市场风险是影响中国 A 股收益率的重要因素，但 CAPM 模型的解释力相对有限。\n市场异象在中国市场更为显著: 规模效应、价值效应、动量效应等市场异象在中国市场可能更为显著，CAPM 模型难以解释这些现象。\n多因子模型在中国市场更适用: 为了更准确地描述中国市场的资产定价，需要构建多因子模型，引入更多风险因子。\n市场有效性有待提高: 中国 A 股市场有效性相对较低，市场摩擦和投资者行为偏差可能导致 CAPM 模型定价偏差。",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>资本资产定价模型 (CAPM)</span>"
    ]
  },
  {
    "objectID": "02_capm.html#capm-模型的局限性",
    "href": "02_capm.html#capm-模型的局限性",
    "title": "3  资本资产定价模型 (CAPM)",
    "section": "3.6 CAPM 模型的局限性",
    "text": "3.6 CAPM 模型的局限性\nCAPM 模型虽然是资产定价理论的基石，但在实际应用中存在诸多局限性，理解这些局限性有助于我们更合理地使用模型，并认识到后续模型发展的必要性。\n\n单因子模型的局限:\n\n只考虑市场风险: CAPM 模型只考虑了市场组合这一个系统性风险因子，而现实市场中可能存在多种风险因子影响资产收益率，例如：\n\n规模风险: 小市值公司可能面临更大的经营风险和流动性风险。\n价值风险: 价值型公司（高账面市值比）可能面临盈利能力下降的风险。\n盈利能力风险: 盈利能力较弱的公司可能面临经营困境。\n\n无法解释所有收益率差异: 实证研究表明，CAPM 模型无法完全解释不同资产之间的收益率差异，存在 定价误差 (\\(\\alpha_i \\neq 0\\))。\n\n对市场有效性的过度假设:\n\n市场并非完美: 现实市场存在交易成本、信息不对称、卖空限制等，这些市场摩擦会影响 CAPM 模型的有效性。\n投资者行为偏差: CAPM 模型假设投资者是完全理性的，但行为金融学研究表明，投资者存在各种非理性行为偏差，如过度自信、羊群效应等，这些偏差也会导致市场定价偏离 CAPM 模型的预测。\n\n实证检验的挑战:\n\n市场组合难以定义: CAPM 理论中的市场组合是包含所有资产的组合，但在实际中难以准确定义和获取，通常只能用股票指数（如沪深300、标普500）作为替代，这可能导致检验结果的偏差。\n模型假设难以验证: CAPM 模型的许多假设（如投资者同质性、收益率正态分布）难以直接验证，模型的有效性检验只能是间接的。\n数据和方法的影响: 实证检验结果可能受到数据频率、时间窗口、检验方法等因素的影响，不同的研究可能得出不同的结论。\n\n无法解释市场异象:\n\n市场异象 (Anomalies)：指 CAPM 模型无法解释的、持续存在的超额收益现象。\n常见的市场异象包括：\n\n规模效应 (Size Effect)：小市值股票的平均收益率显著高于 CAPM 模型预测的水平。\n价值效应 (Value Effect)：价值型股票（高账面市值比）的平均收益率显著高于 CAPM 模型预测的水平。\n动量效应 (Momentum Effect)：过去一段时间收益率较高的股票，未来一段时间的收益率也倾向于较高。\n\n市场异象的存在表明 CAPM 模型对现实市场的描述是不完善的，需要引入更多的风险因子或考虑行为金融学因素来解释这些现象。",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>资本资产定价模型 (CAPM)</span>"
    ]
  },
  {
    "objectID": "02_capm.html#总结",
    "href": "02_capm.html#总结",
    "title": "3  资本资产定价模型 (CAPM)",
    "section": "3.7 总结",
    "text": "3.7 总结\n\nCAPM 模型是资产定价理论的重要基石，为资产定价提供了一个基准框架。\nCAPM 模型假设投资者是理性的，市场是有效的，资产价格充分反映了所有可获得的信息。\nCAPM 模型在实际应用中存在诸多局限性，理解这些局限性有助于我们更合理地使用模型，并认识到后续模型发展的必要性。",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>资本资产定价模型 (CAPM)</span>"
    ]
  },
  {
    "objectID": "lab02_capmtest.html",
    "href": "lab02_capmtest.html",
    "title": "4  资本资产定价模型 (CAPM) 实证检验",
    "section": "",
    "text": "4.1 实验目的",
    "crumbs": [
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>资本资产定价模型 (CAPM) 实证检验</span>"
    ]
  },
  {
    "objectID": "lab02_capmtest.html#实验目的",
    "href": "lab02_capmtest.html#实验目的",
    "title": "4  资本资产定价模型 (CAPM) 实证检验",
    "section": "",
    "text": "掌握 CAPM 模型的横截面回归检验方法: 学习横截面回归方法进行CAPM检验。\n使用 Python 进行 CAPM 实证检验: 熟悉使用 Python 进行数据获取、回归分析和结果分析。\n检验 CAPM 模型在中国股票市场的适用性: 使用中国股票市场数据，实证检验 CAPM 模型是否在中国市场成立。\n理解 CAPM 模型的局限性: 通过实证结果，加深对 CAPM 模型局限性的理解。",
    "crumbs": [
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>资本资产定价模型 (CAPM) 实证检验</span>"
    ]
  },
  {
    "objectID": "lab02_capmtest.html#实验原理",
    "href": "lab02_capmtest.html#实验原理",
    "title": "4  资本资产定价模型 (CAPM) 实证检验",
    "section": "4.2 实验原理",
    "text": "4.2 实验原理\n\n4.2.1 CAPM 模型回顾\n资本资产定价模型 (CAPM) 描述了风险资产的预期收益率与系统性风险之间的关系。其核心公式为证券市场线 (SML)：\n\\(E(R_i) = R_f + \\beta_i[E(R_m) - R_f]\\)\n其中：\n\n\\(E(R_i)\\)：资产 \\(i\\) 的期望收益率\n\\(R_f\\)：无风险利率\n\\(\\beta_i\\)：资产 \\(i\\) 的 Beta 系数，衡量系统性风险\n\\(E(R_m)\\)：市场组合的期望收益率\n\\([E(R_m) - R_f]\\)：市场风险溢价\n\n\n\n4.2.2 CAPM 模型的实证检验方法\n本实验将采用投资组合分组法 (Portfolio Grouping) 对 CAPM 模型进行实证检验：\n投资组合分组法 (Portfolio Grouping)\n为解决个股Beta估计误差大的问题，我们采用投资组合分组法进行CAPM检验。这种方法最早由Black, Jensen, and Scholes (1972)提出，能够显著减少Beta估计误差对检验结果的影响。\n实证模型如下：\n\\(\\overline{R}_{p} = \\gamma_{0} + \\gamma_{1} \\overline{\\beta}_p + \\eta_{p}\\)\n\n\\(\\gamma_{0}\\) 代表零 Beta 组合的预期收益率，如果 CAPM 成立，\\(\\gamma_{0}\\) 应接近无风险利率 \\(R_f\\)。\n\\(\\gamma_{1}\\) 代表风险溢价，如果 CAPM 成立，\\(\\gamma_{1}\\) 应等于市场风险溢价 \\(E(R_m) - R_f\\)，且显著为正。\n\\(\\overline{R}_{p}\\) 和 \\(\\overline{\\beta}_p\\) 分别是投资组合的平均收益率和平均Beta值。\n\n步骤：\n\n第一步：时间序列回归估计个股Beta值：使用时间序列回归模型，对每只股票 \\(i\\) 估计其 Beta 值 \\(\\beta_i\\)。\n第二步：按Beta大小分组：根据Beta大小将股票分成多个投资组合(本实验分为10组)。\n第三步：计算组合特征：计算每个投资组合的平均Beta和平均收益率。\n第四步：组合级别回归：使用投资组合的平均Beta和平均收益率进行横截面回归。\n\n与直接使用个股数据进行横截面回归相比，投资组合分组法有以下优势： - 降低Beta估计误差的影响，提高检验结果的稳健性 - 分散非系统性风险，更好地捕捉Beta与平均收益率之间的关系 - 减少极端值对回归结果的影响 - 更符合投资者实际持有多样化投资组合的实践",
    "crumbs": [
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>资本资产定价模型 (CAPM) 实证检验</span>"
    ]
  },
  {
    "objectID": "lab02_capmtest.html#实验数据",
    "href": "lab02_capmtest.html#实验数据",
    "title": "4  资本资产定价模型 (CAPM) 实证检验",
    "section": "4.3 实验数据",
    "text": "4.3 实验数据\n本实验使用中国 A 股市场数据进行检验。\n\n股票数据: 选取上证A股作为研究对象。\n市场指数: 使用上证指数作为市场组合的代理。\n无风险利率: 使用中国国债利率作为无风险利率的代理。\n数据区间: 选择2015年至2024年的历史数据。\n数据频率: 使用周度数据。\n\n数据来源: CSMAR（学校IP登陆）",
    "crumbs": [
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>资本资产定价模型 (CAPM) 实证检验</span>"
    ]
  },
  {
    "objectID": "lab02_capmtest.html#实验步骤",
    "href": "lab02_capmtest.html#实验步骤",
    "title": "4  资本资产定价模型 (CAPM) 实证检验",
    "section": "4.4 实验步骤",
    "text": "4.4 实验步骤\n\n4.4.1 导入必要的 Python 库\nimport pandas as pd\nimport numpy as np\nimport statsmodels.api as sm\nimport os\nfrom glob import glob\nimport matplotlib.pyplot as plt\n\n\n4.4.2 读取市场指数数据\n###################################\n# 第一步：读取市场指数数据\n# 市场指数代表整体市场的表现，是CAPM模型中的市场组合\n###################################\nindex_files = \"./data/mktret_weekly/TRD_Weekm.xlsx\"\nmarket_data = pd.read_excel(index_files, header=0, skiprows=3, names=['Markettype', 'Trdwnt', 'Wretwdos', 'Dnstkcal'])\n\n# 选择上证A股市场(Markettype=1)的流通市值加权平均回报率(Wretwdos)\n# 流通市值加权平均回报率更能代表真实的市场表现，因为它考虑了不同股票的市场规模\nmarket_data = market_data[market_data['Markettype'] == 1]\n\n# 把Trdwnt（YYYY-WW）转换为两个变量：year和week\nmarket_data['year'] = market_data['Trdwnt'].str[:4]\nmarket_data['week'] = market_data['Trdwnt'].str[5:]\n\n# 筛选year为2015至2024的数据\n# 选择近10年数据，既保证样本量充足，又能反映当前市场特征\nmarket_data = market_data[market_data['year'] &gt;= '2015']\nmarket_data = market_data[market_data['year'] &lt;= '2024']\n\n\n4.4.3 读取无风险利率数据\n###################################\n# 第二步：读取无风险利率数据\n# 无风险利率是CAPM模型的重要组成部分，代表投资者在不承担风险时的最低收益要求\n###################################\nrf_files = \"./data/rf_weekly/TRD_Nrrate.xlsx\"\nrf_data = pd.read_excel(rf_files, header=0, skiprows=2, names=['Nrr1', 'Clsdt', 'Nrrdaydt'])\n\n# 把rf从百分数单位转换为小数\n# 统一单位便于后续计算超额收益率\nrf_data['Nrrdaydt'] = rf_data['Nrrdaydt'] / 100\n\n# 把Clsdt转换为日期格式\nrf_data['Clsdt'] = pd.to_datetime(rf_data['Clsdt'])\n\n# 把Clsdt转换为交易周份（周数从1开始）\n# 这一步是为了将日度数据转换为周度数据，与股票和市场数据保持一致\nrf_data['Trdwnt'] = rf_data['Clsdt'].dt.strftime('%Y-%U').apply(\n    lambda x: f\"{x.split('-')[0]}-{int(x.split('-')[1]) + 1:02d}\"\n)\n\n# 把Trdwnt转换为两个变量：year和week\nrf_data['year'] = rf_data['Trdwnt'].str[:4]\nrf_data['week'] = rf_data['Trdwnt'].str[5:]\n\n# 对rf在year和week上算平均值\n# 由于一周内可能有多个无风险利率数据，取平均值作为该周的代表值\nrf_data = rf_data.groupby(['year', 'week']).agg({'Nrrdaydt': 'mean'}).reset_index()\n\n# 筛选year为2015至2024的数据\nrf_data = rf_data[rf_data['year'] &gt;= '2015']\nrf_data = rf_data[rf_data['year'] &lt;= '2024']\n\n\n4.4.4 读取所有股票回报率数据\n###################################\n# 第三步：读取所有股票回报率数据(2015-2024)\n# 个股回报率是CAPM检验的核心数据，用于估计Beta和验证模型预测\n###################################\n# 读取stockret_weekly中所有excel表格\nstockret_folders = \"./data/stockret_weekly\"\nstock_files = glob(os.path.join(stockret_folders, \"*.xlsx\"))\nprint(f\"找到股票数据文件: {stock_files}\")\n\n# 创建一个空的DataFrame来存储所有股票数据\nstock_data_list = []\n\n# 循环读取文件\nfor file in stock_files:\n    temp_data = pd.read_excel(file, header=0, skiprows=3, names=['Stkcd', 'Trdwnt', 'Wretwd', 'Markettype'])\n    stock_data_list.append(temp_data)\n\n# 合并所有股票数据\nstock_data = pd.concat(stock_data_list, ignore_index=True)\n\n# 只选择上证A股市场(Markettype=1)\n# 保持与市场指数一致，确保样本的一致性\nstock_data = stock_data[stock_data['Markettype'] == 1]\n\n# 把Trdwnt转换为两个变量：year和week\nstock_data['year'] = stock_data['Trdwnt'].str[:4]\nstock_data['week'] = stock_data['Trdwnt'].str[5:]\n\n# 筛选year为2015至2024的数据\nstock_data = stock_data[stock_data['year'] &gt;= '2015']\nstock_data = stock_data[stock_data['year'] &lt;= '2024']\n\n# 检查Stkcd的唯一值的数量\n# 了解样本中包含多少只股票，样本规模越大，结果越具有代表性\nprint(f\"Stkcd的唯一值的数量: {stock_data['Stkcd'].nunique()}\")\n\n\n4.4.5 合并数据框\n###################################\n# 第四步：合并数据框\n# 将股票、市场和无风险利率数据合并，为后续分析做准备\n###################################\n# 将 stock_data 与 market_data 按 ['year', 'week'] 合并\nmerged_data = pd.merge(stock_data, market_data, on=['year', 'week'], how='left')\n\n# 将 merged_data 与 rf_data 按 ['year', 'week'] 合并\nmerged_data = pd.merge(merged_data, rf_data, on=['year', 'week'], how='left')\n\n# 新建market_excess_return列，计算市场超额回报率\n# 市场超额回报率 = 市场回报率 - 无风险利率，代表承担市场风险获得的额外收益\nmerged_data['market_excess_return'] = merged_data['Wretwdos'] - merged_data['Nrrdaydt']\n\n# 计算市场风险溢价\n# 市场风险溢价是CAPM模型中的重要参数，代表投资者承担系统性风险的补偿\nmarket_risk_premium = merged_data['market_excess_return'].mean()\nprint(f\"市场风险溢价: {market_risk_premium}\")\n\n\n4.4.6 时间序列回归估计Beta\n###################################\n# 第五步：时间序列回归估计Beta\n# Beta是CAPM模型的核心参数，衡量个股对市场风险的敏感度\n###################################\n# 先对一个股票做回归测试结果\n# 筛选Stkcd == 600169的数据\nmerged_data0 = merged_data[merged_data['Stkcd'] == 600169]\n\n# 做回归（添加缺失值处理）\n# 先删除包含缺失值的行\nmerged_data0 = merged_data0.dropna(subset=['market_excess_return', 'Wretwd'])\n\n# 进行时间序列回归：R_i = α_i + β_i(R_m - R_f) + ε_i\n# 这里我们直接用总回报率而非超额回报率作为因变量，这是一种变形的CAPM检验方法\nmodel = sm.OLS(merged_data0['Wretwd'], sm.add_constant(merged_data0['market_excess_return'])).fit()\n\n# 展示回归结果\n# 常数项代表Alpha，斜率代表Beta\nprint(model.summary())\n\n###################################\n\n# 将 merged_data 按 stkcd 分组，做回归，y 是 Wretwd, x 是 market_excess_return\n# 将回归结果存储在time_series_results字典中\ntime_series_results = {}\nfor stock_code in merged_data['Stkcd'].unique():\n    individual_data = merged_data[merged_data['Stkcd'] == stock_code]\n    # 先删除包含缺失值的行\n    individual_data = individual_data.dropna(subset=['market_excess_return', 'Wretwd'])\n    # 筛选行数超过30的，否则跳过\n    # 样本量过小会导致回归结果不可靠\n    if len(individual_data) &gt; 30:\n        model = sm.OLS(individual_data['Wretwd'], sm.add_constant(individual_data['market_excess_return'])).fit()\n        time_series_results[stock_code] = model\n    else:\n        print(f\"股票{stock_code}的行数不足30，跳过\")\n\n# 提取回归结果中的beta值\n# Beta值代表个股对市场风险的敏感度，Beta&gt;1表示该股票比市场更具波动性\nbeta_values = [result.params[1] for result in time_series_results.values()]\n\n# beta_values需要与对应股票代码合并\nbeta_values = pd.DataFrame({'Stkcd': list(time_series_results.keys()), 'beta': beta_values})\n\n\n4.4.7 横截面回归检验CAPM模型\n###################################\n# 第六步：使用投资组合分组法检验CAPM模型\n# 投资组合分组法通过将股票按Beta分组，计算组合平均Beta和收益率，\n# 再进行回归，能够显著减少Beta估计误差的影响，提高检验结果的稳健性\n###################################\n# 对beta_values进行分组，从小到大等分为10组，生成一列group\n# 分组可以减少个股特异性风险的影响，更好地检验系统性风险与收益的关系\nbeta_values['group'] = pd.qcut(beta_values['beta'], q=10, labels=False, duplicates='drop')\n\n# 根据股票代码合并股票数据\ncapm_data = pd.merge(stock_data, beta_values, on='Stkcd', how='left')\n\n# 把capm_data按group分组，计算每组的股票平均回报率、beta平均值，放在一个DataFrame中\n# 组合可以分散非系统性风险，更好地反映Beta与收益率的关系\ngroup_data = capm_data.groupby('group').agg({'Wretwd': 'mean', 'beta': 'mean'})\n\n# 使用Wretwd对beta进行回归，计算截距和斜率\n# 横截面回归模型：R_i = γ_0 + γ_1 * β_i + η_i\n# γ_0应接近无风险利率，γ_1应接近市场风险溢价\nmodel = sm.OLS(group_data['Wretwd'], sm.add_constant(group_data['beta'])).fit()\n\n# 展示回归结果\nprint(model.summary())\n\n# 提取并解释结果\ngamma_0 = model.params['const']  # 零Beta组合收益率\ngamma_1 = model.params['beta']   # 市场风险溢价估计值\np_value_gamma_0 = model.pvalues['const']  # 零Beta组合收益率的显著性\np_value_gamma_1 = model.pvalues['beta']   # 市场风险溢价的显著性\n\nprint(f\"\\nCAPM横截面回归结果解释:\")\nprint(f\"γ0 (零Beta组合收益率) = {gamma_0:.6f}, p值 = {p_value_gamma_0:.6f}\")\nprint(f\"γ1 (市场风险溢价) = {gamma_1:.6f}, p值 = {p_value_gamma_1:.6f}\")\nprint(f\"实际市场风险溢价 = {market_risk_premium:.6f}\")\n\n# CAPM检验结论\nprint(\"\\nCAPM检验结论:\")\nif p_value_gamma_0 &lt; 0.05:\n    print(f\"- γ0 ({gamma_0:.6f}) 显著，表明零Beta组合收益率存在\")\nelse:\n    print(f\"- γ0 ({gamma_0:.6f}) 不显著，无法确定零Beta组合收益率\")\n\nif p_value_gamma_1 &lt; 0.05:\n    if gamma_1 &gt; 0:\n        print(f\"- γ1 ({gamma_1:.6f}) 显著为正，表明Beta风险被市场定价\")\n        if abs(gamma_1 - market_risk_premium) &lt; 0.01:\n            print(f\"  且接近实际市场风险溢价 ({market_risk_premium:.6f})，支持CAPM模型\")\n        else:\n            print(f\"  但与实际市场风险溢价 ({market_risk_premium:.6f}) 存在差异，CAPM模型部分成立\")\n    else:\n        print(f\"- γ1 ({gamma_1:.6f}) 显著但为负值，与CAPM预期不符，表明Beta风险未被正确定价\")\nelse:\n    print(f\"- γ1 ({gamma_1:.6f}) 不显著，表明Beta风险未被市场定价，CAPM模型在此样本中不成立\")\n\n\n4.4.8 作图\n###################################\n# 第七步：画图\n# 在图上画出投资组合平均Beta和收益率，与回归线\n###################################\n# 设置绘图风格\nplt.style.use('ggplot')\n# 根据操作系统设置不同的字体\nimport platform\n# 获取操作系统类型\nsystem = platform.system()\n# 设置 matplotlib 字体\nif system == 'Windows':\n    plt.rcParams['font.sans-serif'] = ['SimHei']  # Windows 使用黑体\nelif system == 'Darwin':\n    plt.rcParams['font.sans-serif'] = ['Songti SC']  # Mac 使用宋体\nelse:\n    plt.rcParams['font.sans-serif'] = ['WenQuanYi Zen Hei']  # Linux 使用文泉驿正黑\n# 解决负号显示问题\nplt.rcParams['axes.unicode_minus'] = False\n\n# 画图并保存\nplt.figure(figsize=(10, 6))\nplt.scatter(group_data['beta'], group_data['Wretwd'], alpha=0.7)\nplt.plot(group_data['beta'], gamma_0 + gamma_1 * group_data['beta'], 'r-', linewidth=2)\nplt.title('Beta与平均收益率的关系')\nplt.xlabel('Beta系数')\nplt.ylabel('平均周收益率')\nplt.grid(True, alpha=0.3)\nplt.annotate(f'R2 = {model.rsquared:.4f}', xy=(0.05, 0.95), xycoords='axes fraction')\nplt.annotate(f'γ0 = {gamma_0:.6f}', xy=(0.05, 0.90), xycoords='axes fraction')\nplt.annotate(f'γ1 = {gamma_1:.6f}', xy=(0.05, 0.85), xycoords='axes fraction')\nplt.savefig('capm_scatter.png')\nprint(\"已保存Beta与平均收益率的散点图\")",
    "crumbs": [
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>资本资产定价模型 (CAPM) 实证检验</span>"
    ]
  },
  {
    "objectID": "lab02_capmtest.html#实验结果",
    "href": "lab02_capmtest.html#实验结果",
    "title": "4  资本资产定价模型 (CAPM) 实证检验",
    "section": "4.5 实验结果",
    "text": "4.5 实验结果\n本实验采用投资组合分组法检验了CAPM模型。如果CAPM模型成立，我们期望：\n\n截距项（\\(\\gamma_0\\)）应接近无风险利率，代表零Beta组合的收益率\nBeta系数（\\(\\gamma_1\\)）应显著为正，且接近市场风险溢价，代表承担系统性风险的补偿\n\n下图展示了投资组合平均Beta与平均收益率的散点图及回归线：\n\n\n\nBeta与平均收益率的关系",
    "crumbs": [
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>资本资产定价模型 (CAPM) 实证检验</span>"
    ]
  },
  {
    "objectID": "lab02_capmtest.html#结论与讨论",
    "href": "lab02_capmtest.html#结论与讨论",
    "title": "4  资本资产定价模型 (CAPM) 实证检验",
    "section": "4.6 结论与讨论",
    "text": "4.6 结论与讨论\n根据投资组合分组法的实验结果，我们可以分析CAPM模型在中国A股市场的适用性：\n\n系统性风险的定价：\n\n观察投资组合回归中Beta系数是否显著，以及其解释能力（R方）的大小\nR方值代表投资组合平均收益率中能被Beta解释的部分\n与个股回归相比，投资组合回归的R方通常较高，因为分组降低了特异性风险的影响\n\n零Beta组合收益率：\n\n比较 \\(\\gamma_0\\) 与无风险利率的差异\n如果 \\(\\gamma_0\\) 显著高于无风险利率，可能存在其他风险因子未被模型捕捉\nBlack, Jensen, and Scholes (1972)的研究表明，零Beta组合收益率通常高于无风险利率\n\n风险溢价：\n\n检验 \\(\\gamma_1\\) 是否显著为正，并与实际市场风险溢价比较\n如果 \\(\\gamma_1\\) 显著为正且接近市场风险溢价，支持CAPM模型\n如果 \\(\\gamma_1\\) 不显著或为负，表明系统性风险未被市场正确定价\n\nCAPM模型的局限性：\n\n中国股票市场的特殊性：政策驱动、散户主导、信息不对称\n可能需要考虑其他风险因子：规模效应、价值效应、动量效应等\n即使使用投资组合分组法降低了估计误差，CAPM仍可能无法充分解释中国市场的收益率差异\n\n\n通过这些分析，我们可以评估CAPM模型在中国市场的适用性，并讨论可能的局限性。",
    "crumbs": [
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>资本资产定价模型 (CAPM) 实证检验</span>"
    ]
  },
  {
    "objectID": "lab02_capmtest.html#实验总结",
    "href": "lab02_capmtest.html#实验总结",
    "title": "4  资本资产定价模型 (CAPM) 实证检验",
    "section": "4.7 实验总结",
    "text": "4.7 实验总结\n本实验通过投资组合分组法检验了CAPM模型在中国A股市场的适用性。我们首先估计了个股的Beta系数，然后按Beta大小将股票分组，计算投资组合的平均Beta和平均收益率，最后检验了Beta与平均收益率之间的关系。\n与直接使用个股数据相比，投资组合分组法有以下优势： 1. 降低了Beta估计误差的影响 2. 分散了非系统性风险 3. 减少了极端值对回归结果的影响 4. 更符合投资者实际持有多样化投资组合的实践\n这种实证检验方法不仅帮助我们验证金融理论，也为投资决策和资产定价提供了实证依据。通过对比理论预期与实证结果，我们可以更深入地理解中国股票市场的风险-收益特征，为投资组合构建和风险管理提供指导。",
    "crumbs": [
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>资本资产定价模型 (CAPM) 实证检验</span>"
    ]
  },
  {
    "objectID": "03_ff3.html",
    "href": "03_ff3.html",
    "title": "5  Fama-French三因子模型",
    "section": "",
    "text": "5.1 本节课主要内容",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Fama-French三因子模型</span>"
    ]
  },
  {
    "objectID": "03_ff3.html#本节课主要内容",
    "href": "03_ff3.html#本节课主要内容",
    "title": "5  Fama-French三因子模型",
    "section": "",
    "text": "多因子模型的理论基础: 理解从CAPM单因子模型到多因子模型的演进逻辑\nFama-French三因子模型的构建: 掌握市值因子(SMB)和价值因子(HML)的构建方法\n三因子模型的经济学解释: 理解三因子模型中各因子的经济含义\n三因子模型的实证检验: 学习三因子模型在美国市场的实证检验结果\n中国市场的三因子模型变体: 了解三因子模型在中国市场的适用性与变体形式",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Fama-French三因子模型</span>"
    ]
  },
  {
    "objectID": "03_ff3.html#多因子模型的理论基础",
    "href": "03_ff3.html#多因子模型的理论基础",
    "title": "5  Fama-French三因子模型",
    "section": "5.2 多因子模型的理论基础",
    "text": "5.2 多因子模型的理论基础\n\n5.2.1 从CAPM到多因子模型\nCAPM模型作为单因子模型虽然结构简洁，但在实证检验中面临诸多挑战。多因子模型的出现是对CAPM模型的自然扩展，目的是解决单因子模型无法解释的市场异象和风险溢价来源。\n\nCAPM模型的局限性回顾:\n\n只考虑市场风险一种系统性风险\n无法解释诸如规模效应、价值效应等市场异象\n实证检验中经常出现Alpha显著不为零的情况\n\n多因子模型的基本思想:\n\n风险来源多元化: 认为资产收益率受多种系统性风险因子影响，而非仅受市场风险影响\n扩展风险溢价来源: 投资者要求的风险溢价来自于对多种系统性风险的补偿\n更好的解释力: 通过引入更多风险因子，提高模型对资产收益率横截面差异的解释能力\n\n\n\n\n5.2.2 多因子模型的一般形式\n多因子模型通常采用如下的线性形式：\n\\[R_i - R_f = \\alpha_i + \\beta_{i,1}F_1 + \\beta_{i,2}F_2 + ... + \\beta_{i,K}F_K + \\epsilon_i\\]\n其中： - \\(R_i - R_f\\): 资产\\(i\\)的超额收益率 - \\(\\alpha_i\\): 截距项，如果模型准确，理论上应该为零 - \\(\\beta_{i,k}\\): 资产\\(i\\)对风险因子\\(k\\)的敏感度 - \\(F_k\\): 第\\(k\\)个风险因子的风险溢价 - \\(\\epsilon_i\\): 资产特有的非系统性风险，即残差项\n\n\n5.2.3 多因子模型的类型\n\n经济理论驱动的多因子模型:\n\n基于经济理论推导出的风险因子\n例如：Ross (1976)的套利定价理论(APT)、Merton (1973)的跨期资本资产定价模型(ICAPM)\n优势：有坚实的理论基础；劣势：难以确定具体的风险因子\n\n统计技术驱动的多因子模型:\n\n使用统计方法如主成分分析(PCA)从数据中提取共同因子\n例如：Chen, Roll and Ross (1986)的宏观经济因子模型\n优势：数据拟合度高；劣势：因子缺乏明确的经济含义\n\n异象驱动的多因子模型:\n\n基于市场中观察到的异象构建因子\n例如：Fama-French三因子模型、Carhart四因子模型\n优势：直接解决已知的市场异象；劣势：可能存在过度拟合风险",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Fama-French三因子模型</span>"
    ]
  },
  {
    "objectID": "03_ff3.html#fama-french三因子模型的构建",
    "href": "03_ff3.html#fama-french三因子模型的构建",
    "title": "5  Fama-French三因子模型",
    "section": "5.3 Fama-French三因子模型的构建",
    "text": "5.3 Fama-French三因子模型的构建\n\n5.3.1 三因子模型的提出背景\n\n市场异象的挑战:\n\n20世纪80-90年代，学者发现许多CAPM无法解释的市场异象\n其中最显著的是规模效应(小市值股票表现优于大市值股票)和价值效应(高账面市值比股票表现优于低账面市值比股票)\n\nFama和French的贡献:\n\n1992年，Eugene Fama和Kenneth French发表了著名论文《The Cross-Section of Expected Stock Returns》\n1993年，他们进一步发表《Common risk factors in the returns on stocks and bonds》，正式提出三因子模型\n他们将规模和价值引入资产定价模型，构建了影响深远的三因子模型\n\n\n\n\n5.3.2 三因子模型的数学表达式\nFama-French三因子模型的数学表达式如下：\n\\[R_i - R_f = \\alpha_i + \\beta_i(R_m - R_f) + s_i \\cdot SMB + h_i \\cdot HML + \\epsilon_i\\]\n其中： - \\(R_i - R_f\\): 资产\\(i\\)的超额收益率 - \\(R_m - R_f\\): 市场组合的超额收益率(市场因子) - \\(SMB\\): 规模因子(Small Minus Big)，小市值股票与大市值股票的收益率差 - \\(HML\\): 价值因子(High Minus Low)，高账面市值比股票与低账面市值比股票的收益率差 - \\(\\beta_i\\), \\(s_i\\), \\(h_i\\): 分别是资产\\(i\\)对三个因子的敏感度 - \\(\\alpha_i\\): 截距项，表示模型无法解释的超额收益率 - \\(\\epsilon_i\\): 残差项\n\n\n5.3.3 SMB因子构建方法\nSMB(Small Minus Big)是衡量规模效应的因子，代表小市值股票相对于大市值股票的超额收益。\n\n分组步骤:\n\n规模划分: 根据股票市值大小将所有股票分为两组：\n\n小市值组(S): 市值低于中位数的股票\n大市值组(B): 市值高于中位数的股票\n\n账面市值比划分: 将股票按照账面市值比(B/M)分为三组：\n\n低B/M组(L): B/M比值处于最低30%的股票\n中B/M组(M): B/M比值处于中间40%的股票\n高B/M组(H): B/M比值处于最高30%的股票\n\n形成六个投资组合: 将上述两种分类交叉，形成六个投资组合：\n\n小市值/低B/M(S/L)\n小市值/中B/M(S/M)\n小市值/高B/M(S/H)\n大市值/低B/M(B/L)\n大市值/中B/M(B/M)\n大市值/高B/M(B/H)\n\n\nSMB计算公式: \\[SMB = \\frac{1}{3}[(S/L - B/L) + (S/M - B/M) + (S/H - B/H)]\\]\n即小市值组合的平均收益率减去大市值组合的平均收益率\n\n\n\n5.3.4 HML因子构建方法\nHML(High Minus Low)是衡量价值效应的因子，代表高账面市值比股票相对于低账面市值比股票的超额收益。\n\n使用相同的六个投资组合:\nHML计算公式: \\[HML = \\frac{1}{2}[(S/H - S/L) + (B/H - B/L)]\\]\n即高B/M组合的平均收益率减去低B/M组合的平均收益率\n\n\n\n5.3.5 因子构建的实际考量\n\n重构频率: 通常每年或每半年重新构建一次投资组合\n财务数据时滞: 使用上一财年末的账面价值数据，确保数据可获得性\n异常值处理: 剔除账面价值为负的股票，处理极端值\n市值计算: 通常使用流通市值而非总市值，以反映实际可交易部分",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Fama-French三因子模型</span>"
    ]
  },
  {
    "objectID": "03_ff3.html#三因子模型的经济学解释",
    "href": "03_ff3.html#三因子模型的经济学解释",
    "title": "5  Fama-French三因子模型",
    "section": "5.4 三因子模型的经济学解释",
    "text": "5.4 三因子模型的经济学解释\n\n5.4.1 市场因子(\\(R_m - R_f\\))的经济学解释\n\n继承自CAPM: 市场因子代表了整体市场风险，与CAPM模型中的市场风险相同\n系统性风险补偿: 衡量了投资者承担整体市场风险所要求的风险溢价\n不可分散性: 代表了通过分散化投资无法消除的系统性风险\n\n\n\n5.4.2 规模因子(SMB)的经济学解释\nFama和French认为SMB因子代表了小市值公司所承担的额外系统性风险：\n\n经济脆弱性假说: 小市值公司更容易受到经济衰退的冲击，在经济困难时期表现更差\n信息不对称假说: 小市值公司信息透明度较低，投资者承担更高的信息风险\n流动性风险假说: 小市值股票流动性较差，投资者要求额外的流动性溢价\n财务困境假说: 小市值公司更容易面临财务困境和破产风险\n\n\n\n5.4.3 价值因子(HML)的经济学解释\nHML因子代表了高B/M公司所承担的额外系统性风险：\n\n财务困境风险假说: 高B/M公司通常财务状况较差，面临更高的违约风险\n成长机会假说: 高B/M公司通常缺乏成长机会，在经济衰退时更容易受损\n盈利持续性假说: 高B/M公司的盈利能力通常较弱或波动较大，持续性较差\n投资者情绪假说: 投资者倾向于过度看好成长型公司，导致价值型公司被低估\n\n\n\n5.4.4 行为金融学视角的解释\n行为金融学提供了不同于理性风险定价的解释：\n\n过度反应假说: 投资者对公司短期业绩过度反应，导致价值股被低估，成长股被高估\n投资者情绪: 投资者偏好成长型股票，愿意为成长预期支付额外溢价\n彩票偏好: 投资者偏好具有彩票特性的小市值成长股\n注意力效应: 大市值公司受到更多关注，定价可能更为有效",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Fama-French三因子模型</span>"
    ]
  },
  {
    "objectID": "03_ff3.html#三因子模型的实证检验",
    "href": "03_ff3.html#三因子模型的实证检验",
    "title": "5  Fama-French三因子模型",
    "section": "5.5 三因子模型的实证检验",
    "text": "5.5 三因子模型的实证检验\n\n5.5.1 美国市场的经典检验结果\nFama和French在原始论文中的主要发现：\n\n显著改善解释力: 相比CAPM模型，三因子模型解释了更多股票收益率的横截面差异\n规模效应的捕捉: 模型成功解释了小市值股票的超额收益\n价值效应的捕捉: 模型成功解释了高B/M股票的超额收益\n强大的统计显著性: 三个因子的风险溢价在统计上显著不为零\n时间稳定性: 因子风险溢价在不同时期表现出相对稳定性\n\n\n\n5.5.2 主要实证方法\n\n时间序列回归:\n\n对单个资产或投资组合进行时间序列回归\n检验因子敏感度(\\(\\beta\\), \\(s\\), \\(h\\))是否显著，以及截距项\\(\\alpha\\)是否趋近于零\n\n横截面回归:\n\n使用Fama-MacBeth回归检验因子风险溢价是否显著\n检验三因子模型是否能解释资产收益率的横截面差异\n\n投资组合分析:\n\n构建不同特征的投资组合，检验三因子模型的解释能力\n通常使用独立排序形成的规模-价值分组(如25个投资组合)\n\n\n\n\n5.5.3 后续研究的发现\n\n稳健性: 三因子模型在不同市场和时期都表现出较好的稳健性\n适用范围: 模型不仅适用于股票市场，也可以扩展到债券和其他资产类别\n进一步的市场异象: 研究发现了三因子模型仍无法解释的异象，如动量效应、盈利能力效应等\n模型拓展: 促使了四因子、五因子等更复杂模型的发展",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Fama-French三因子模型</span>"
    ]
  },
  {
    "objectID": "03_ff3.html#中国市场的三因子模型变体",
    "href": "03_ff3.html#中国市场的三因子模型变体",
    "title": "5  Fama-French三因子模型",
    "section": "5.6 中国市场的三因子模型变体",
    "text": "5.6 中国市场的三因子模型变体\n\n5.6.1 中国市场特征与三因子模型适用性\n中国股票市场具有独特特征，影响了三因子模型的适用性：\n\n新兴市场特性: 中国作为新兴市场，市场效率相对较低，投机性较强\n政府干预: 政府政策对市场影响较大，造成独特的风险来源\n投资者结构: 以散户为主的投资者结构导致行为偏差更为显著\n特殊制度安排: 如股权分置改革、涨跌幅限制等特殊制度\nA股与H股市场分割: 同一公司在A股和H股市场的定价差异明显，反映了市场分割效应\n交易限制因素: 包括做空限制、涨跌停板制度等对因子表现产生影响\n\n\n\n5.6.2 中国市场规模与价值因子的实证研究\n根据Liu, Stambaugh和Yuan (2019)的”Size and Value in China”研究，中国市场的规模和价值因子表现出一些独特特点，需要特殊处理：\n\n小市值股票的壳价值扭曲:\n\n中国市场最小30%的股票存在明显的壳价值（shell value）问题，价格反映了被用作反向收购（reverse merger）壳公司的潜在价值\n反向收购为民企提供了绕过繁琐IPO审批的后门上市途径\n小市值股票回报率显著受到壳价值变化的影响，而非传统风险因素\n\n中国特色三因子模型（CH-3）:\n\n针对中国市场特点，构建了排除最小30%市值股票的规模因子（SMC）\n使用市盈率（E/P）替代账面市值比（B/M）构建价值因子（VMG），因其在中国市场表现更好\nCH-3模型（由市场因子、SMC和VMG组成）显著优于传统FF-3模型\n\n超强解释力:\n\nCH-3模型能解释中国市场中10种常见异象中的8种\n相比之下，传统FF-3模型仅能解释3种异象\n贝叶斯检验显示CH-3模型在解释因子表现上显著优于FF-3模型\n\n\n\n\n5.6.3 中国市场实证检验结果的最新发现\n基于Liu, Stambaugh和Yuan (2019)的研究与其他中国学者的实证结果，CH-3模型相比传统模型的优势表现在：\n\n规模因子修正后的表现:\n\n剔除最小30%市值股票后，规模效应变得更加稳健可预测\n经修正的规模因子(SMC)风险溢价显著且稳定\n最小市值组股票表现出与其他规模组显著不同的收益率模式，符合壳价值假说\n大中型股票的规模效应更能反映真实的风险溢价\n\n价值因子的选择优化:\n\nE/P（市盈率倒数）作为价值度量在中国市场表现显著优于B/M\n价值因子(VMG)能更好地捕捉盈利能力与成长机会的信息\n调整后的价值因子与宏观经济的联系更加紧密\n价值因子在避开极小市值股票的样本中表现更为稳健\n\n因子间相互关系:\n\n修正后的规模因子与价值因子相关性降低，提供更好的分散化效果\nCH-3模型三个因子对应的因子组合呈现更低的相关性\n与美国市场不同，中国市场的小市值与高价值不总是正相关\n经济周期和政策环境对因子相关性有重要影响\n\n异象解释能力:\n\nCH-3模型能解释大多数中国市场的异象现象，包括：\n\n盈利能力异象\n波动率异象\n反转效应\n…\n\n模型解释力在排除最小30%市值股票的样本中进一步提升\n贝叶斯分析显示CH-3在各种情景下都优于FF-3模型\n\n\n\n\n5.6.4 三因子模型在中国市场实践应用的特殊考量\n基于Liu等人(2019)的研究成果和国内实证发现，在中国市场应用三因子模型时需考虑以下特殊因素：\n\n规模因子构建调整:\n\n应剔除市值最小的30%股票，以避免壳价值效应的干扰\n使用SMC（Excluding Small）替代传统SMB，提高规模因子的风险解释力\n规模分组可考虑使用非对称划分（如30%-70%），更适合中国市场的规模分布特征\n\n价值因子指标选择:\n\nE/P（市盈率倒数）在中国市场表现优于传统B/M\n构建VMG（Value Minus Growth）价值因子，替代传统HML\n剔除负收益公司，或使用复合价值指标以提高稳定性\n\n反向收购与制度因素考量:\n\n关注壳资源价值随政策变化的动态影响\n监控小市值股票的异常收益率波动，尤其在监管政策调整期\n考虑将壳价值变化作为额外风险因子纳入模型\n\n数据质量与频率选择:\n\n中国市场数据质量问题，尤其是早期数据和财务报告可靠性\n考虑使用季度而非月度频率来构建更稳健的因子\n多样本期检验，关注市场制度变革前后的模型表现差异",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Fama-French三因子模型</span>"
    ]
  },
  {
    "objectID": "03_ff3.html#总结",
    "href": "03_ff3.html#总结",
    "title": "5  Fama-French三因子模型",
    "section": "5.7 总结",
    "text": "5.7 总结\n\nFama-French三因子模型通过引入规模因子(SMB)和价值因子(HML)，极大提高了对股票收益横截面差异的解释能力。\n三因子模型的每个因子都有其经济学解释，可以被视为对特定系统性风险的补偿。\n在中国市场，传统三因子模型需要根据中国市场特点进行调整，Liu等人(2019)提出的CH-3模型（剔除小市值股票的规模因子SMC和基于市盈率的价值因子VMG）显著优于传统FF-3模型。\n中国市场的壳价值效应是小市值股票定价的关键因素，应在构建因子和应用模型时予以特别考虑。\n多因子模型的框架为后续资产定价模型的发展奠定了基础，每个市场可能需要根据其特有的制度环境和市场特征调整模型设定。",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Fama-French三因子模型</span>"
    ]
  },
  {
    "objectID": "lab03_ff3test.html",
    "href": "lab03_ff3test.html",
    "title": "6  实践：构建和回测中国特色三因子模型(CH-3)",
    "section": "",
    "text": "6.1 数据说明",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>实践：构建和回测中国特色三因子模型(CH-3)</span>"
    ]
  },
  {
    "objectID": "lab03_ff3test.html#数据说明",
    "href": "lab03_ff3test.html#数据说明",
    "title": "6  实践：构建和回测中国特色三因子模型(CH-3)",
    "section": "",
    "text": "6.1.1 数据来源\n本实验所使用的数据来自CSMAR(国泰安) http://data.csmar.com/，主要包括：\n\n基本信息: 公司研究系列 -&gt; 上市公司基本信息 -&gt; 上市公司基本信息年度表\n股票市场信息: 股票市场系列 -&gt; 股票市场交易 -&gt; 个股交易数据 -&gt; 月个股回报率文件\n无风险利率: 股票市场系列 -&gt; 股票市场交易 -&gt; 汇率及利率 -&gt; 无风险利率文件\n多因子: 因子研究系列 -&gt; Fama-French因子 -&gt; 五因子模型指标(月)\n财务数据: 公司研究系列 -&gt; 财务指标分析 -&gt; 披露财务指标\n\n\n\n6.1.2 样本与变量选择\n\n时间范围: 2007年5月至2019年2月\n样本选择: 上海与深圳A股非金融、非公用事业上市企业\n主要变量:\n\n基本信息: 股票代码、行业代码、上市日期\n股票市场信息: 考虑现金红利再投资的月个股回报率、月个股总市值\n无风险利率: 月度化无风险利率\n五因子: 市场风险溢价因子、市值因子、账面市值比因子(均为总市值加权)\n财务信息: 归属于上市公司股东的扣除非经常性损益的净利润、加权平均净资产收益率\n\n\n\n\n6.1.3 实验步骤概要\n\n导入整理数据，保证各数据库间的变量及单位等保持一致\n选取A股非金融、非公用事业上市公司\n合并上市公司股票信息与财务信息，并保留市值处于最大的70%的上市企业\n每月根据市值与价值对企业进行排序分组，计算每个投资组合的市值加权平均收益率\n构造中国三因子，并计算中国三因子在中国市场的解释力度\n构造ROE异象，比较CAPM、中国三因子与Fama-French三因子模型的解释能力\n分析结果并得出结论",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>实践：构建和回测中国特色三因子模型(CH-3)</span>"
    ]
  },
  {
    "objectID": "lab03_ff3test.html#本次实验内容",
    "href": "lab03_ff3test.html#本次实验内容",
    "title": "6  实践：构建和回测中国特色三因子模型(CH-3)",
    "section": "6.2 本次实验内容",
    "text": "6.2 本次实验内容\n\n数据准备和预处理: 学习如何获取和处理中国股票数据\n构建中国特色规模因子: 掌握中国特色规模因子(SMB)的构建方法\n构建中国特色价值因子: 掌握基于市盈率的价值因子(VMG)的构建方法\n回测因子收益: 学习如何对因子进行回测和性能评估\n因子有效性分析: 了解如何评估因子的有效性和统计显著性",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>实践：构建和回测中国特色三因子模型(CH-3)</span>"
    ]
  },
  {
    "objectID": "lab03_ff3test.html#背景中国特色三因子模型ch-3",
    "href": "lab03_ff3test.html#背景中国特色三因子模型ch-3",
    "title": "6  实践：构建和回测中国特色三因子模型(CH-3)",
    "section": "6.3 背景：中国特色三因子模型(CH-3)",
    "text": "6.3 背景：中国特色三因子模型(CH-3)\n根据Liu, Stambaugh和Yuan (2019)的”Size and Value in China”研究，中国市场具有独特的特点，传统Fama-French三因子模型需要进行调整：\n\n壳价值效应：中国市场最小30%的股票存在明显的壳价值现象，其价格受到被用作反向收购壳公司潜在价值的影响，而非传统风险因素\n规模因子调整：需要剔除最小30%市值股票，构建SMB（Small Minus Big）因子，以避免壳价值的干扰\n价值因子调整：市盈率（E/P）在中国市场的表现优于账面市值比（B/M），因此使用E/P构建VMG（Value Minus Growth）价值因子\n超强解释力：调整后的CH-3模型在解释中国市场异象方面显著优于传统FF-3模型\n\n本实验将带领大家一步步构建中国特色三因子模型，并通过对ROE异象的解释力分析来验证该模型的有效性。我们将使用真实的中国股票市场数据，从数据预处理开始，经过因子构建、回测到最终的统计分析。",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>实践：构建和回测中国特色三因子模型(CH-3)</span>"
    ]
  },
  {
    "objectID": "lab03_ff3test.html#实践构建和回测中国特色三因子模型",
    "href": "lab03_ff3test.html#实践构建和回测中国特色三因子模型",
    "title": "6  实践：构建和回测中国特色三因子模型(CH-3)",
    "section": "6.4 实践：构建和回测中国特色三因子模型",
    "text": "6.4 实践：构建和回测中国特色三因子模型\n\n6.4.1 第一步：导入必要的库\n首先，我们需要导入本实验所需的Python库。这些库包括数据处理的pandas和numpy，可视化的matplotlib和seaborn，以及统计分析的statsmodels和scipy等。\n# 导入必要的库\nimport pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport statsmodels.api as sm\nfrom scipy import stats\nfrom pandas.tseries.offsets import MonthEnd\nimport seaborn as sns\nfrom statsmodels.regression.rolling import RollingOLS\nfrom statsmodels.stats.sandwich_covariance import cov_hac\n\n# 设置绘图风格\nplt.style.use('ggplot')\n# 根据操作系统设置不同的字体\nimport platform\n# 获取操作系统类型\nsystem = platform.system()\n# 设置 matplotlib 字体\nif system == 'Windows':\n    plt.rcParams['font.sans-serif'] = ['SimHei']  # Windows 使用黑体\nelif system == 'Darwin':\n    plt.rcParams['font.sans-serif'] = ['Songti SC']  # Mac 使用宋体\nelse:\n    plt.rcParams['font.sans-serif'] = ['WenQuanYi Zen Hei']  # Linux 使用文泉驿正黑\n# 解决负号显示问题\nplt.rcParams['axes.unicode_minus'] = False\n\n\n6.4.2 第二步：读入数据\n接下来，我们需要读取中国股票市场的相关数据。这些数据包括：公司基本信息、财务指标、交易数据、无风险利率和市场因子数据。在实际应用中，这些数据通常来自于CSMAR、Wind等专业金融数据库。\n# 基本信息\ncominfo = pd.read_excel(\"data/basic_info/STK_LISTEDCOINFOANL.xlsx\", skiprows=3,\n                       names=[\"Symbol\", \"ShortName\", \"EndDate\", \"ListedCoID\", \"SecurityID\", \n                              \"IndustryName\", \"IndustryCode\", \"IndustryNameC\", \"IndustryCodeC\",\n                              \"IndustryNameD\", \"IndustryCodeD\", \"RegisterAddress\", \"OfficeAddress\",\n                              \"Zipcode\", \"Secretary\", \"SecretaryTel\", \"SecretaryFax\", \"SecretaryEmail\",\n                              \"SecurityConsultant\", \"SocialCreditCode\", \"Sigchange\", \"Lng\", \"Lat\",\n                              \"ISIN\", \"FullName\", \"LegalRepresentative\", \"EstablishDate\", \"Crcd\",\n                              \"RegisterCapital\", \"Website\", \"BusinessScope\", \"RegisterLongitude\",\n                              \"RegisterLatitude\", \"EMAIL\", \"LISTINGDATE\", \"PROVINCECODE\", \"PROVINCE\",\n                              \"CITYCODE\", \"CITY\", \"MAINBUSSINESS\", \"LISTINGSTATE\"])\n\n# 财务指标(ROE)\ncomfin = pd.read_excel(\"data/ROE/FI_T2.xlsx\", skiprows=3,\n                      names=[\"Stkcd\", \"ShortName\", \"Accper\", \"nr\", \"npexnr\", \"ROE\", \"ROE_exnr\"],\n                      dtype={'Stkcd': str, 'nr': float, 'npexnr': float, 'ROE': float, 'ROE_exnr': float})\n\n# 个股交易数据\ntrdmnth = pd.read_excel(\"data/stk_monthly/TRD_Mnth.xlsx\", skiprows=3,\n                       names=[\"Stkcd\", \"Trdmnt\", \"Opndt\", \"Mopnprc\", \"Clsdt\", \n                              \"Mclsprc\", \"Mnshrtrd\", \"Mnvaltrd\", \"Msmvosd\", \n                              \"Msmvttl\", \"Ndaytrd\", \"Mretwd\", \"Mretnd\", \n                              \"Markettype\", \"Capchgdt\", \"Ahshrtrd_M\", \"Ahvaltrd_M\"])\n\n# 无风险利率\nnrrate = pd.read_excel(\"data/rf_monthly/TRD_Nrrate.xlsx\", skiprows=3,\n                      names=[\"Nrr1\", \"Clsdt\", \"Nrrmtdt\"])\n\n# 五因子\nfacmnth = pd.read_excel(\"data/five_factors/STK_MKT_FIVEFACMONTH.xlsx\", skiprows=3,\n                       names=[\"MarkettypeID\", \"TradingMonth\", \"Portfolios\", \n                              \"RiskPremium1\", \"RiskPremium2\", \"SMB1\", \"SMB2\",\n                              \"HML1\", \"HML2\", \"RMW1\", \"RMW2\", \"CMA1\", \"CMA2\"])\n\n\n6.4.3 第三步：整理数据\n数据读入后，我们需要对数据进行整理和初步分析。这包括：行业分类、过滤非A股和金融公用事业公司等。\n# 行业信息\nindinfo = (cominfo.groupby(['IndustryName', 'IndustryCode'])\n           .size()\n           .reset_index()\n           .rename(columns={0: 'count'})\n           .sort_values('IndustryCode'))\n\n# A股、非金融公用事业行业\ncomA = cominfo.copy()\ncomA['EndDate'] = pd.to_datetime(comA['EndDate'])\ncomA['year'] = comA['EndDate'].dt.year\ncomA['LISTINGDATE'] = pd.to_datetime(comA['LISTINGDATE'])\n\n# 过滤条件：上市后数据 + 非金融非公用事业 + A股\ncomA = comA[\n    (comA['EndDate'] &gt;= comA['LISTINGDATE']) & \n    (~comA['IndustryCode'].str.startswith('J')) & \n    (~comA['IndustryCode'].str.startswith('D')) &\n    (~comA['Symbol'].astype(str).str[:3].isin(['900', '200']))\n]\n\n\n6.4.4 第四步：财务数据处理\n这一步我们处理财务数据，包括与公司信息的合并、填充缺失值等。由于财务数据的披露通常有滞后性，我们需要确保使用最新可获得的财务数据。我们还需要处理一些特殊情况，例如：\n\n对财务数据进行向下填充，确保在新数据公布前使用最近期的有效数据\n将交易数据转换为适当的格式，并调整收益率计算方式\n\n# 财务数据处理\ncomfin['Accper'] = pd.to_datetime(comfin['Accper'])\ncomfin['year'] = comfin['Accper'].dt.year\ncomfin['month'] = comfin['Accper'].dt.month\n\n# 合并财务数据与公司基本信息\ncomfin = pd.merge(comfin, comA, left_on=['Stkcd', 'year'], \n                   right_on=['Symbol', 'year'], how='inner')\n\n# 向下填充财务数据（模拟R中的fill函数）\ncomfin = comfin.sort_values(['Stkcd', 'year', 'month'])\ncomfin['npexnr'] = comfin.groupby('Stkcd')['npexnr'].fillna(method='ffill')\ncomfin['ROE'] = comfin.groupby('Stkcd')['ROE'].fillna(method='ffill')\ncomfin['Stkcd'] = pd.to_numeric(comfin['Stkcd'])\n\n# 交易数据处理\ntrdmnth['Trdmnt'] = pd.to_datetime(trdmnth['Trdmnt'])\ntrdmnth['ym'] = pd.to_datetime(trdmnth['Trdmnt']).dt.to_period('M')\ntrdmnth['year'] = trdmnth['Trdmnt'].dt.year\ntrdmnth['month'] = trdmnth['Trdmnt'].dt.month\ntrdmnth['Mretwd'] = trdmnth['Mretwd'] * 100  # 转换为百分比\n\n# 无风险利率处理\nnrrate['Clsdt'] = pd.to_datetime(nrrate['Clsdt'])\nnrrate['year'] = nrrate['Clsdt'].dt.year\nnrrate['month'] = nrrate['Clsdt'].dt.month\nrf = nrrate.groupby(['year', 'month'])['Nrrmtdt'].mean().reset_index()\nrf = rf.rename(columns={'Nrrmtdt': 'rf'})\n\n# 因子数据处理\nfacmnth = facmnth[(facmnth['MarkettypeID'] == 'P9714') & (facmnth['Portfolios'] == 1)]\nfacmnth['TradingMonth'] = pd.to_datetime(facmnth['TradingMonth'])\nfacmnth['ym'] = facmnth['TradingMonth'].dt.to_period('M')\n# 转换为百分比\nfactor_cols = ['RiskPremium1', 'SMB2', 'HML2', 'RMW2', 'CMA2']\nfacmnth[factor_cols] = facmnth[factor_cols] * 100\n\n\n6.4.5 第五步：合并数据集与构造变量\n在这一步，我们将合并处理后的各数据集，并计算关键变量，如市值和市盈率(E/P)。特别地，为了实现中国特色三因子模型的核心思想，我们筛选出市值最大的70%的企业，以剔除可能受到壳价值影响的小市值股票。\n# 应用规则到交易数据\ntrddata = trdmnth.copy()\n# 根据月份调整年份：1-4月使用上一年，其他月份使用当前年\ntrddata['year1'] = np.where((trddata['month'] &gt;= 1) & (trddata['month'] &lt;= 4), \n                           trddata['year'] - 1, \n                           trddata['year'])\n# 根据月份调整财务月份：\n# 5-8月对应3月（一季报），9-10月对应6月（二季报），其他月份对应9月（三季报）\ntrddata['month1'] = np.select(\n    [(trddata['month'] &gt;= 5) & (trddata['month'] &lt;= 8),\n     (trddata['month'] == 9) | (trddata['month'] == 10)],\n    [3, 6],\n    default=9\n)\n\n# a. 合并财务数据\ntrddata = pd.merge(trddata, comfin, \n                  left_on=['Stkcd', 'year1', 'month1'], \n                  right_on=['Stkcd', 'year', 'month'], \n                  how='inner')\ntrddata = trddata.drop(columns=['year_y', 'month_y'])\ntrddata = trddata.rename(columns={'year_x': 'year', 'month_x': 'month'})\n\n# b. 计算总市值和市盈率\ntrddata = trddata.sort_values(['Stkcd', 'ym'])\ntrddata['size'] = trddata.groupby('Stkcd')['Mclsprc'].shift(1) * (trddata['Msmvttl'] / trddata['Mclsprc'])\ntrddata['EP'] = trddata['npexnr'] / trddata['size']\n\n# c. 筛选市值最大的70%的企业\ndef filter_by_size(group):\n    size_threshold = group['size'].quantile(0.3)\n    return group[group['size'] &gt;= size_threshold]\n\ntrddata = trddata.groupby('ym').apply(filter_by_size).reset_index(drop=True)\n\n# d. 合并无风险利率并计算超额收益率\ntrddata = pd.merge(trddata, rf, on=['year', 'month'], how='left')\ntrddata['exret'] = trddata['Mretwd'] - trddata['rf']\n\n# e. 筛选时间范围\ntrddata['ym_dt'] = trddata['ym'].dt.to_timestamp()\ntrddata = trddata[(trddata['ym_dt'] &gt;= pd.Timestamp('2007-05-01')) & \n                  (trddata['ym_dt'] &lt;= pd.Timestamp('2019-02-28'))]\n\n\n6.4.6 第六步：对size、value、ROE进行排序分组\n按照Fama-French的经典方法，我们需要对股票进行分组以构建因子。在这一步，我们将按照市值进行2组划分，按照E/P进行3组划分，并额外对ROE进行10组划分用于后续异象分析。\n# 按市值、EP、ROE进行分组\ntrddata_grp = trddata.copy()\n\n# 市值分组（2组）\ntrddata_grp['grp_size'] = trddata_grp.groupby('ym')['size'].transform(\n    lambda x: pd.qcut(x, 2, labels=[1, 2]).astype(int)\n)\n\n# EP价值分组（3组）\ndef get_value_group(x):\n    if x.notna().any():\n        low_val = x.quantile(0.3)\n        high_val = x.quantile(0.7)\n        return np.select(\n            [x &lt;= low_val, x &lt;= high_val],\n            [1, 2],\n            default=3\n        )\n    return np.nan\n\ntrddata_grp['grp_value'] = trddata_grp.groupby('ym')['EP'].transform(get_value_group)\n\n# ROE分组（10组），处理空值情况\ndef roe_group(x):\n    if x.notna().any():\n        # 先处理空值，将空值替换为-1\n        x_filled = x.fillna(-1)\n        # 使用qcut分组，将-1单独分为一组\n        groups = pd.qcut(x_filled, 10, labels=range(1, 11), duplicates='drop')\n        # 将-1对应的组别设为NaN\n        groups = groups.where(x_filled != -1, np.nan)\n        return groups.astype('Int64')  # 使用可空整数类型\n    return np.nan\n\ntrddata_grp['grp_ROE'] = trddata_grp.groupby('ym')['ROE'].transform(roe_group)\n\n# 市值分组（10组，用于条件分组）\ntrddata_grp['grp_size1'] = trddata_grp.groupby('ym')['size'].transform(\n    lambda x: pd.qcut(x, 10, labels=range(1, 11)).astype(int)\n)\n\n# 在每个市值组内对ROE进行条件分组，处理空值情况\ndef roe_con_group(x):\n    if x.notna().any():\n        # 先处理空值，将空值替换为-1\n        x_filled = x.fillna(-1)\n        # 使用qcut分组，将-1单独分为一组\n        groups = pd.qcut(x_filled, 10, labels=range(1, 11), duplicates='drop')\n        # 将-1对应的组别设为NaN\n        groups = groups.where(x_filled != -1, np.nan)\n        return groups.astype('Int64')  # 使用可空整数类型\n    return np.nan\n\ntrddata_grp['grp_ROE_con'] = trddata_grp.groupby(['ym', 'grp_size1'])['ROE'].transform(roe_con_group)\n\n\n6.4.7 第七步：计算加权平均股票回报率与定价因子\n这一步是构建因子的核心环节。我们首先计算市场超额收益率(MKT)，然后构建2×3分组的投资组合，计算基于规模的SMB因子和基于价值的VMG因子。\nCH-3模型采用的分组方式与经典Fama-French模型相似，但有一些关键调整： 1. 我们使用已剔除最小30%市值股票的样本进行分组 2. 按市值分为两组（小市值和大市值） 3. 按E/P比率分为三组（30%-40%-30%） 4. 形成6个投资组合：小市值低E/P(11)、小市值中E/P(12)、小市值高E/P(13)、大市值低E/P(21)、大市值中E/P(22)、大市值高E/P(23)\n# 计算市场超额收益率\nfactor1 = trddata_grp.groupby('ym').agg(\n    MKT=('exret', lambda x: np.average(x, weights=trddata_grp.loc[x.index, 'size']))\n).reset_index()\n\n# 根据size和value排序计算投资组合回报\ndef calc_portfolio_return(group):\n    return np.average(group['Mretwd'], weights=group['size'])\n\nfactor2 = trddata_grp.groupby(['ym', 'grp_size', 'grp_value']).apply(\n    calc_portfolio_return\n).reset_index()\nfactor2.columns = ['ym', 'grp_size', 'grp_value', 'vwret']\n\n# 只保留不含NaN的组合\nfactor2 = factor2[factor2['grp_size'].notna() & factor2['grp_value'].notna()]\n\n# 创建组合标识并透视表\nfactor2['grp'] = factor2['grp_size'] * 10 + factor2['grp_value']\nfactor2_pivot = factor2.pivot(index='ym', columns='grp', values='vwret').reset_index()\n\n# 计算SMB和VMG因子\nfactor2_pivot['SMB'] = (factor2_pivot[11] + factor2_pivot[12] + factor2_pivot[13]) / 3 - \\\n                      (factor2_pivot[21] + factor2_pivot[22] + factor2_pivot[23]) / 3\nfactor2_pivot['VMG'] = (factor2_pivot[13] + factor2_pivot[23]) / 2 - \\\n                      (factor2_pivot[11] + factor2_pivot[21]) / 2\n\n# 合并所有因子\nfactor = factor2_pivot.merge(factor1, on='ym')\nfactor = factor.merge(facmnth[['ym', 'RiskPremium1', 'SMB2', 'HML2']], on='ym', how='left')\n\n\n6.4.8 第八步：描述性统计和因子相关性分析\n在构建完成三因子后，我们需要对因子进行统计分析，了解其基本特征和相互关系。这些分析可以帮助我们了解： - 各因子的平均收益率和波动性 - 因子的分布特性（最小值、最大值、中位数等） - 因子之间的相关性，这对了解多因子模型中的因子独立性很重要\n通常，我们希望看到因子之间的相关性不太高，这样每个因子都能捕捉股票收益率中的不同风险来源。\n# 描述性统计\nfactor_stats = factor[['MKT', 'SMB', 'VMG']].describe().T\nfactor_stats['P0'] = factor_stats['min']\nfactor_stats['P25'] = factor[['MKT', 'SMB', 'VMG']].quantile(0.25)\nfactor_stats['Median'] = factor[['MKT', 'SMB', 'VMG']].median()\nfactor_stats['P75'] = factor[['MKT', 'SMB', 'VMG']].quantile(0.75)\nfactor_stats['P100'] = factor_stats['max']\nprint(\"因子描述性统计:\")\nprint(factor_stats[['count', 'mean', 'std', 'P0', 'P25', 'Median', 'P75', 'P100']])\n\n# 相关系数\nfactor_corr = factor[['MKT', 'SMB', 'VMG']].corr()\nprint(\"\\n因子相关系数:\")\nprint(factor_corr)\n\n\n6.4.9 第九步：ROE异象分析\n为了验证CH-3模型的有效性，我们分析其对ROE异象的解释能力。ROE（净资产收益率）是衡量公司盈利能力的重要指标，高ROE的股票通常表现出超额收益。\n我们使用两种方法构建ROE异象组合： 1. 无条件分组：直接按ROE对所有股票进行十分位分组，计算高ROE组合与低ROE组合的收益率差 2. 市值中性分组：在每个市值十分位内分别按ROE进行分组，控制规模效应的影响\n两种方法的对比可以帮助我们了解ROE异象是否受到规模效应的影响。\n# 基于ROE的投资组合形成（无条件分组）\ndef calc_roe_portfolio(trddata_grp):\n    # 无条件分组\n    roe_port = trddata_grp.groupby(['ym', 'grp_ROE']).apply(\n        lambda x: pd.Series({\n            'vwret': np.average(x['Mretwd'], weights=x['size'])\n        })\n    ).reset_index()\n    \n    # 只保留不含NaN的组合\n    roe_port = roe_port[roe_port['grp_ROE'].notna()]\n    \n    # 转为宽格式\n    roe_port_wide = roe_port.pivot(index='ym', columns='grp_ROE', values='vwret').reset_index()\n    \n    # 计算高减低ROE组合回报\n    roe_port_wide['rmw'] = roe_port_wide[10] - roe_port_wide[1]\n    \n    return roe_port_wide[['ym', 'rmw']]\n\n# 基于市值中性的ROE投资组合形成（条件分组）\ndef calc_size_neutral_roe(trddata_grp):\n    # 条件分组（市值中性）\n    sn_port = trddata_grp.groupby(['ym', 'grp_ROE_con']).apply(\n        lambda x: pd.Series({\n            'vwret': np.average(x['Mretwd'], weights=x['size'])\n        })\n    ).reset_index()\n    \n    # 只保留不含NaN的组合\n    sn_port = sn_port[sn_port['grp_ROE_con'].notna()]\n    \n    # 转为宽格式\n    sn_port_wide = sn_port.pivot(index='ym', columns='grp_ROE_con', values='vwret').reset_index()\n    \n    # 计算高减低ROE组合回报\n    sn_port_wide['rmw_sn'] = sn_port_wide[10] - sn_port_wide[1]\n    \n    return sn_port_wide[['ym', 'rmw_sn']]\n\n# 计算ROE投资组合\nfactor3 = calc_roe_portfolio(trddata_grp)\nfactor4 = calc_size_neutral_roe(trddata_grp)\n\n# 合并所有因子数据\nfactor_all = factor.merge(factor3, on='ym').merge(factor4, on='ym')\n\n\n6.4.10 第十步：使用Newey-West调整的标准误差估计因子模型\n接下来，我们使用Newey-West调整的标准误差进行回归分析，比较CH-3模型与传统CAPM、FF-3模型在解释ROE异象方面的能力。\n# 使用Newey-West调整的标准误差估计因子模型\ndef nw_regression(y, X, lags=4):\n    \"\"\"使用Newey-West调整的标准误差进行回归\"\"\"\n    # 准备数据\n    X = sm.add_constant(X)\n    \n    # 拟合模型\n    model = sm.OLS(y, X).fit()\n    \n    # 使用Newey-West调整标准误差\n    cov = cov_hac(model, nlags=lags)\n    model_nw = model.get_robustcov_results(cov_type='HAC', maxlags=lags)\n    \n    return model_nw\n\n# 进行因子模型回归\nprint(\"\\nROE异象的因子模型分析:\")\n\n# 无条件分组 - CAPM\nmodel1 = nw_regression(factor_all['rmw'], factor_all[['MKT']])\nprint(\"\\n无条件分组 - CAPM模型:\")\nprint(model1.summary().tables[1])\n\n# 无条件分组 - 三因子\nmodel2 = nw_regression(factor_all['rmw'], factor_all[['MKT', 'SMB', 'VMG']])\nprint(\"\\n无条件分组 - 三因子模型:\")\nprint(model2.summary().tables[1])\n\n# 无条件分组 - Fama-French三因子\nmodel3 = nw_regression(factor_all['rmw'], factor_all[['MKT', 'SMB2', 'HML2']])\nprint(\"\\n无条件分组 - Fama-French三因子模型:\")\nprint(model3.summary().tables[1])\n\n# 条件分组 - CAPM\nmodel4 = nw_regression(factor_all['rmw_sn'], factor_all[['MKT']])\nprint(\"\\n条件分组 - CAPM模型:\")\nprint(model4.summary().tables[1])\n\n# 条件分组 - 三因子\nmodel5 = nw_regression(factor_all['rmw_sn'], factor_all[['MKT', 'SMB', 'VMG']])\nprint(\"\\n条件分组 - 三因子模型:\")\nprint(model5.summary().tables[1])\n\n# 条件分组 - Fama-French三因子\nmodel6 = nw_regression(factor_all['rmw_sn'], factor_all[['MKT', 'SMB2', 'HML2']])\nprint(\"\\n条件分组 - Fama-French三因子模型:\")\nprint(model6.summary().tables[1])\n\n\n6.4.11 第十一步：绘图分析\n为了直观展示因子表现，我们绘制三因子和ROE异象收益的时间序列图。\n# 绘制因子收益时间序列图\nplt.figure(figsize=(12, 8))\n\nplt.subplot(3, 1, 1)\nplt.plot(factor_all['ym'].dt.to_timestamp(), factor_all['MKT'], 'b-')\nplt.title('市场风险溢价 (MKT)')\nplt.grid(True)\n\nplt.subplot(3, 1, 2)\nplt.plot(factor_all['ym'].dt.to_timestamp(), factor_all['SMB'], 'g-')\nplt.title('规模因子 (SMB)')\nplt.grid(True)\n\nplt.subplot(3, 1, 3)\nplt.plot(factor_all['ym'].dt.to_timestamp(), factor_all['VMG'], 'r-')\nplt.title('价值因子 (VMG)')\nplt.grid(True)\n\nplt.tight_layout()\nplt.savefig('三因子收益.png')\nplt.close()\n\n# 绘制ROE异象收益\nplt.figure(figsize=(12, 6))\n\nplt.subplot(2, 1, 1)\nplt.plot(factor_all['ym'].dt.to_timestamp(), factor_all['rmw'], 'b-')\nplt.title('无条件分组ROE异象 (High-Low)')\nplt.grid(True)\n\nplt.subplot(2, 1, 2)\nplt.plot(factor_all['ym'].dt.to_timestamp(), factor_all['rmw_sn'], 'g-')\nplt.title('市值中性ROE异象 (High-Low)')\nplt.grid(True)\n\nplt.tight_layout()\nplt.savefig('ROE异象收益.png')\nplt.close()\n\n# 保存三因子数据\nfactor_all.to_csv('中国三因子与ROE异象.csv', index=False)\nprint(\"\\n因子数据已保存到'中国三因子与ROE异象.csv'\")\n\n\n6.4.12 计算绩效指标函数（用于评估）\n以下是计算投资组合绩效指标的函数，可用于评估因子表现：\ndef calculate_performance(returns_series):\n    \"\"\"\n    计算投资组合绩效指标\n    \n    参数:\n    returns_series: 包含收益率的Series\n    \n    返回:\n    绩效指标字典\n    \"\"\"\n    # 计算累积收益\n    cumulative_return = (1 + returns_series).cumprod().iloc[-1] - 1\n    \n    # 计算年化收益率\n    n_periods = len(returns_series)\n    periods_per_year = 12  # 假设为月度数据\n    annualized_return = (1 + cumulative_return) ** (periods_per_year / n_periods) - 1\n    \n    # 计算年化波动率\n    annualized_vol = returns_series.std() * np.sqrt(periods_per_year)\n    \n    # 计算夏普比率 (假设无风险利率为0)\n    sharpe_ratio = annualized_return / annualized_vol if annualized_vol != 0 else 0\n    \n    # 计算最大回撤\n    cum_returns = (1 + returns_series).cumprod()\n    running_max = cum_returns.cummax()\n    drawdown = (cum_returns / running_max) - 1\n    max_drawdown = drawdown.min()\n    \n    # 计算t统计量\n    t_stat, p_value = stats.ttest_1samp(returns_series, 0)\n    \n    return {\n        'Cumulative Return': cumulative_return,\n        'Annualized Return': annualized_return,\n        'Annualized Volatility': annualized_vol,\n        'Sharpe Ratio': sharpe_ratio,\n        'Max Drawdown': max_drawdown,\n        't-statistic': t_stat,\n        'p-value': p_value\n    }",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>实践：构建和回测中国特色三因子模型(CH-3)</span>"
    ]
  },
  {
    "objectID": "lab03_ff3test.html#结果分析与讨论",
    "href": "lab03_ff3test.html#结果分析与讨论",
    "title": "6  实践：构建和回测中国特色三因子模型(CH-3)",
    "section": "6.5 结果分析与讨论",
    "text": "6.5 结果分析与讨论\n通过上述分析，我们可以评估中国特色三因子模型(CH-3)的有效性。从理论和实证结果看，CH-3模型相比传统FF-3模型在中国市场有以下优势：\n\n规模因子改进：通过剔除最小30%市值股票，避免了壳价值效应对规模因子的影响，使规模因子更能反映真实的风险溢价。\n价值因子改进：使用市盈率(E/P)替代账面市值比(B/M)构建价值因子，更适合中国市场特点，提高了模型解释力。\n对异象的解释能力：从ROE异象的回归结果可以看出，CH-3模型对中国市场的盈利能力异象有较强的解释能力，特别是在控制规模效应后。\n稳健性：从因子收益的时间序列分析可以看出，CH-3模型的因子在不同市场环境下表现相对稳定。\n\n这一结果印证了Liu, Stambaugh和Yuan (2019)的研究发现，即中国股票市场存在独特的壳价值现象，需要针对这一特点调整因子模型。同时，选择更适合中国市场的价值指标也是提高模型性能的关键。",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>实践：构建和回测中国特色三因子模型(CH-3)</span>"
    ]
  },
  {
    "objectID": "lab03_ff3test.html#实验思考题",
    "href": "lab03_ff3test.html#实验思考题",
    "title": "6  实践：构建和回测中国特色三因子模型(CH-3)",
    "section": "6.6 实验思考题",
    "text": "6.6 实验思考题\n\n为什么在中国市场需要剔除市值最小的30%股票？这种剔除对规模因子表现有何影响？\n为什么在中国市场中E/P比B/M更有效？这与中国股票市场的哪些特点有关？\n在构建CH-3模型时，你认为中国市场的反向收购机制如何影响了小市值股票的定价？\n比较CH-3模型与传统FF-3模型在解释中国市场异象方面的差异，哪些异象能被CH-3模型更好地解释？\n如果政策环境变化导致上市公司的壳价值发生变化，你预计这会对CH-3模型的有效性产生什么影响？",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>实践：构建和回测中国特色三因子模型(CH-3)</span>"
    ]
  },
  {
    "objectID": "lab03_ff3test.html#参考资料",
    "href": "lab03_ff3test.html#参考资料",
    "title": "6  实践：构建和回测中国特色三因子模型(CH-3)",
    "section": "6.7 参考资料",
    "text": "6.7 参考资料\n\nLiu, J., Stambaugh, R. F., & Yuan, Y. (2019). Size and Value in China. Journal of Financial Economics, 134(1), 48-69.\nFama, E. F., & French, K. R. (1993). Common risk factors in the returns on stocks and bonds. Journal of Financial Economics, 33(1), 3-56.\nHu, G. X., Chen, C., Shao, Y., & Wang, J. (2019). Fama–French in China: size and value factors in Chinese stock returns. International Review of Finance, 19(1), 3-44.",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>实践：构建和回测中国特色三因子模型(CH-3)</span>"
    ]
  },
  {
    "objectID": "project1_factor.html",
    "href": "project1_factor.html",
    "title": "7  项目1：因子投资策略构建",
    "section": "",
    "text": "8 项目背景\n因子投资是现代量化投资的核心方法之一，其理论基础可以追溯到Fama-French三因子模型。该模型扩展了传统的资本资产定价模型（CAPM），引入了规模因子（SMB）和价值因子（HML），以更好地解释股票收益的横截面差异。随着研究的深入，学者们又发现了动量因子、质量因子、低波动因子等多种可以产生超额收益的特征因子。\n传统的因子投资策略通常基于财务指标、市场数据或其他可观测的公司特征，构建投资组合以捕获特定因子带来的风险溢价。成功的因子投资需要深入理解因子的经济学原理、统计特性以及实际应用中的约束条件。\n在本项目中，你将有机会应用量化金融的理论知识，设计并实现自己的因子投资策略，并通过严格的统计检验和回测来评估其有效性。",
    "crumbs": [
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>项目1：因子投资策略构建</span>"
    ]
  },
  {
    "objectID": "project1_factor.html#评分标准",
    "href": "project1_factor.html#评分标准",
    "title": "7  项目1：因子投资策略构建",
    "section": "12.1 评分标准",
    "text": "12.1 评分标准\n项目评分将基于以下几个方面：\n\n创新性（20%）：因子设计的原创性与创新度\n方法论（25%）：方法应用的正确性与严谨性\n实证结果（25%）：策略表现及其统计显著性\n分析深度（20%）：对结果的解释与分析深度\n展示质量（10%）：报告与展示的清晰度和专业性",
    "crumbs": [
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>项目1：因子投资策略构建</span>"
    ]
  },
  {
    "objectID": "project1_factor.html#推荐文献",
    "href": "project1_factor.html#推荐文献",
    "title": "7  项目1：因子投资策略构建",
    "section": "13.1 推荐文献",
    "text": "13.1 推荐文献\n[1] Hou, Xue, and Zhang, (2020). Replicating anomalies. Review of Financial Studies, 33, 2019-2133. [2] Liu, Stambaugh, and Yuan, (2019). Size and Value in China. Journal of Financial Economics, 134, 48-69.",
    "crumbs": [
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>项目1：因子投资策略构建</span>"
    ]
  },
  {
    "objectID": "project1_factor.html#在线资源",
    "href": "project1_factor.html#在线资源",
    "title": "7  项目1：因子投资策略构建",
    "section": "13.2 在线资源",
    "text": "13.2 在线资源\n[1] Kenneth French’s Data Library [2] AQR Capital Management Research",
    "crumbs": [
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>项目1：因子投资策略构建</span>"
    ]
  },
  {
    "objectID": "project2_ml_alt_data.html",
    "href": "project2_ml_alt_data.html",
    "title": "8  项目2：机器学习与替代数据在量化投资中的应用",
    "section": "",
    "text": "9 项目背景\n随着计算能力的提升和数据可获取性的增强，机器学习技术与替代数据已成为现代量化投资的重要前沿领域。传统因子投资策略虽然有坚实的理论基础，但往往依赖于线性关系假设和人工特征工程，难以捕捉市场中存在的复杂非线性关系和动态变化。\n机器学习方法通过其强大的模式识别和预测能力，可以自动从大量数据中提取有价值的信息，发现传统方法难以察觉的市场规律。同时，卫星图像、社交媒体情绪、网络搜索量、信用卡消费等替代数据源为投资决策提供了全新的信息维度，可能包含尚未被市场充分定价的信号。\n在本项目中，你将有机会将机器学习算法应用于投资策略开发，或利用替代数据构建创新的量化模型，从而探索超越传统因子投资的可能性。",
    "crumbs": [
      "<span class='chapter-number'>8</span>  <span class='chapter-title'>项目2：机器学习与替代数据在量化投资中的应用</span>"
    ]
  },
  {
    "objectID": "project2_ml_alt_data.html#机器学习路线",
    "href": "project2_ml_alt_data.html#机器学习路线",
    "title": "8  项目2：机器学习与替代数据在量化投资中的应用",
    "section": "12.1 机器学习路线",
    "text": "12.1 机器学习路线\n\n模型选择与设计（1周）\n\n研究不同机器学习模型在金融预测中的优缺点（如随机森林、梯度提升树、神经网络等）\n了解金融数据的特殊性对模型选择的影响\n制定模型设计方案，确定模型架构\n\n数据准备与特征工程（2周）\n\n整合传统市场数据和基本面数据\n设计并实现特征工程管道\n处理样本不平衡、缺失值和异常值\n特征选择与降维\n\n模型训练与验证（2周）\n\n实现时间序列交叉验证框架\n避免前视偏差和数据泄露\n参数调优与模型集成\n评估模型预测能力\n\n投资组合构建与回测（2周）\n\n基于模型预测设计组合权重分配规则\n实现考虑交易成本的回测系统\n分析不同市场环境下的模型表现\n风险管理与绩效归因",
    "crumbs": [
      "<span class='chapter-number'>8</span>  <span class='chapter-title'>项目2：机器学习与替代数据在量化投资中的应用</span>"
    ]
  },
  {
    "objectID": "project2_ml_alt_data.html#另类数据路线",
    "href": "project2_ml_alt_data.html#另类数据路线",
    "title": "8  项目2：机器学习与替代数据在量化投资中的应用",
    "section": "12.2 另类数据路线",
    "text": "12.2 另类数据路线\n\n数据源选择与获取（1周）\n\n评估不同替代数据源的可获取性与潜在价值\n设计数据收集方案\n建立数据获取管道\n确保数据使用合规性\n\n数据处理与信号提取（2周）\n\n文本数据：NLP预处理、情感分析、主题建模\n图像数据：计算机视觉技术、特征提取\n结构化替代数据：时间序列处理、异常检测\n信号构建与初步测试\n\n信号评估与整合（2周）\n\n评估信号的预测能力\n信号去噪与转换\n与传统因子的相关性分析\n信号组合方法设计\n\n投资组合构建与回测（2周）\n\n基于替代数据信号设计投资规则\n实现考虑交易成本和信号时效性的回测系统\n与传统因子策略的比较分析\n风险管理与绩效归因",
    "crumbs": [
      "<span class='chapter-number'>8</span>  <span class='chapter-title'>项目2：机器学习与替代数据在量化投资中的应用</span>"
    ]
  },
  {
    "objectID": "project2_ml_alt_data.html#评分标准",
    "href": "project2_ml_alt_data.html#评分标准",
    "title": "8  项目2：机器学习与替代数据在量化投资中的应用",
    "section": "13.1 评分标准",
    "text": "13.1 评分标准\n项目评分将基于以下几个方面：\n\n创新性（20%）：方法设计和数据使用的创新程度\n技术实现（25%）：机器学习模型或替代数据处理的技术水平\n实证结果（25%）：策略表现及其相对于传统方法的优势\n风险控制（15%）：对策略风险的理解和控制\n可解释性（10%）：对模型决策过程的解释能力\n展示质量（5%）：报告与展示的清晰度和专业性",
    "crumbs": [
      "<span class='chapter-number'>8</span>  <span class='chapter-title'>项目2：机器学习与替代数据在量化投资中的应用</span>"
    ]
  },
  {
    "objectID": "project2_ml_alt_data.html#机器学习部分",
    "href": "project2_ml_alt_data.html#机器学习部分",
    "title": "8  项目2：机器学习与替代数据在量化投资中的应用",
    "section": "14.1 机器学习部分",
    "text": "14.1 机器学习部分\n[1] Adämmer, P., & Schüssler, R. A. (2020). Forecasting the equity premium: mind the news!. Review of Finance, 24(6), 1313-1355.\n[2] Cao, S., Jiang, W., Wang, J. L., & Yang, B. (2021). From man vs. machine to man+ machine: The art and AI of stock analyses (No. w28800). National Bureau of Economic Research.\n[3] Chen, X., Cho, Y. H., Dou, Y., & Lev, B. (2022). Predicting future earnings changes using machine learning and detailed financial data. Journal of Accounting Research, 60(2), 467-515.\n[4] Chen, L., Pelger, M., & Zhu, J. (2023). Deep learning in asset pricing. Management Science, 70(2), 3329-3348.\n[5] Dong, X., Li, Y., Rapach, D. E., & Zhou, G. (2022). Anomalies and the expected market return. The Journal of Finance, 77(1), 639-681.\n[6] Easley, D., López de Prado, M., O’Hara, M., & Zhang, Z. (2021). Microstructure in the machine age. The Review of Financial Studies, 34(7), 3316-3363.\n[7] Freyberger, J., Neuhierl, A., & Weber, M. (2020). Dissecting characteristics nonparametrically. The Review of Financial Studies, 33(5), 2326-2377.\n[8] Gu, S., Kelly, B., & Xiu, D. (2020). Empirical asset pricing via machine learning. The Review of Financial Studies, 33(5), 2223-2273.\n[9] Jiang, J., Kelly, B. T., & Xiu, D. (2023). (Re-)Imag(in)ing price trends. Journal of Finance, 78(6), 3193-3249.\n[10] Ke, Z. T., Kelly, B. T., & Xiu, D. (2019). Predicting returns with text data (No. w26186). National Bureau of Economic Research.\n[11] Kozak, S., Nagel, S., & Santosh, S. (2020). Shrinking the cross-section. Journal of Financial Economics, 135(2), 271-292.\n[12] Leippold, M., Wang, Q., & Zhou, W. (2022). Machine learning in the Chinese stock market. Journal of Financial Economics, 145(2), 64-82.\n\n14.1.1 另类数据部分\n[13] Bartov, E., Faurel, L., & Mohanram, P. S. (2018). Can Twitter help predict firm-level earnings and stock returns?. The Accounting Review, 93(3), 25-57.\n[14] Bernard, D., Blackburne, T., & Thornock, J. (2020). Information flows among rivals and corporate investment. Journal of Financial Economics, 136(3), 760-779.\n[15] Brown, N. C., Crowley, R. M., & Elliott, W. B. (2020). What are you saying? Using topic to detect financial misreporting. Journal of Accounting Research, 58(1), 237-291.\n[16] Buehlmaier, M. M., & Whited, T. M. (2018). Are financial constraints priced? Evidence from textual analysis. The Review of Financial Studies, 31(7), 2693-2728.\n[17] Cao, S., Jiang, W., Yang, B., & Zhang, A. L. (2023). How to talk when a machine is listening: Corporate disclosure in the age of AI. The Review of Financial Studies, 36(9), 3603-3642.\n[18] Cong, L., T., Liang, X., Zhang, & Zhu, W. (2022). Textual Factors: A Scalable, interpretable, and data-driven Approach to Analyzing Unstructured Information. (w33168) Management Science 68(11), 7893-8359.\n[19] Cookson, J. A., & Niessner, M. (2020). Why don’t we agree? Evidence from a social network of investors. The Journal of Finance, 75(1), 173-228.\n[20] Da, Z., Huang, X., & Jin, L. J. (2021). Extrapolative beliefmusics in the cross-section: What can we learn from the crowds?. Journal of Financial Economics, 140(1), 175-196.\n[21] Edmans, A., Fernandez-Perez, A., Garel, A., & Indriawan, I. (2022). Music sentiment and stock returns around the world. Journal of Financial Economics, 145(2), 234-254.\n[22] Eisdorfer, A., Froot, K., Ozik, G., & Sadka, R. (2022). Competition links and stock returns. The Review of Financial Studies, 35(9), 4300-4340.\n[23] Florackis, C., Louca, C., Michaely, R., & Weber, M. (2023). Cybersecurity risk. The Review of Financial Studies, 36(1), 351-407.\n[24] Garcia, D., Hu, X., & Rohrer, M. (2023). The colour of finance words. Journal of Financial Economics, 147(3), 525-549.\n[25] Gómez-Cram, R., & Grotteria, M. (2022). Real-time price discovery via verbal communication: Method and application to Fedspeak. Journal of Financial Economics, 143(3), 993-1025.\n[26] Green, T. C., Huang, R., Wen, Q., & Zhou, D. (2019). Crowdsourced employer reviews and stock returns. Journal of Financial Economics, 134(1), 236-251.\n[27] Hanley, K. W., & Hoberg, G. (2019). Dynamic interpretation of emerging risks in the financial sector. The Review of Financial Studies, 32(12), 4543-4603.\n[28] Hassan, T. A., Hollander, S., Van Lent, L., & Tahoun, A. (2019). Firm-level political risk: Measurement and effects. The Quarterly Journal of Economics, 134(4), 2135-2202.\n[29] Hoberg, G., & Phillips, G. (2016). Text-based network industries and endogenous product differentiation. Journal of Political Economy, 124(5), 1423-1465.\n[30] Hsieh, T. S., Kim, J. B., Wang, R. R., & Wang, Z. (2020). Seeing is believing? Executives’ facial trustworthiness, auditor tenure, and audit fees. Journal极 of Accounting and Economics, 69(1), 101260.\n[31] Huang, X., Ivković, Z., Jiang, J. X., & Wang, I. Y. (202极3). Angel investment and first impressions. Journal of Financial Economics, 149(2), 161-178.\n[32] Huang, A. H., Zang, A. Y., & Zheng, R. (2014). Evidence on the information content of text in analyst reports. The Accounting Review, 89(6), 2151-2180.\n[33] Kalmenovitz, J. (2023). Regulatory intensity and firm-specific exposure. The Review of Financial Studies, 36(8), 3311-3347.\n[34] Li, K., Mai, F., Shen, R., & Yan, X. (2021). Measuring corporate culture using machine learning. The Review of Financial Studies, 34(7), 3265-3315.\n[35] Lowry, M., Michaely, R., & Volkova, E. (2020). Information revealed through the regulatory process: Interactions between the SEC and companies ahead of their IPO. The Review of Financial Studies, 33(12), 5510-5554.\n[36] Manela, A., & Moreira, A. (2017). News implied volatility and disaster concerns. Journal of Financial Economics, 123(1), 137-162.\n[37] Mukherjee, A., Panayotov极, G., & Shon, J. (2021). Eye in the sky: Private satellites and government macro data. Journal of Financial Economics, 141(1), 234-254.\n[38] Obaid, K., & Pukthuanthong, K. (2022). A picture is worth a thousand words: Measuring investor sentiment by combining machine learning and photos from news. Journal of Financial Economics, 144(1), 273-297.\n[39] Sautner, Z., Van Lent, L., Vilkov, G., & Zhang, R. (2023). Firm‐level climate change exposure. The Journal of Finance, 78(3), 1449-1498.\n[40] Tang, V. W. (2018). Wisdom of crowds: Cross‐sectional variation in the informativeness of third‐party‐generated product information on Twitter. Journal of Accounting Research, 56(3), 989-1034.\n[41] Zhu, C. (2019). Big data as a governance mechanism. The Review of Financial Studies, 32(5), 2021-2061.",
    "crumbs": [
      "<span class='chapter-number'>8</span>  <span class='chapter-title'>项目2：机器学习与替代数据在量化投资中的应用</span>"
    ]
  }
]