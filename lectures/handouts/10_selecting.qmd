---
title: "收益模型与组合优化"
---

## 前言

本讲义主要介绍因子投资实践中的两个关键环节：如何构建预测股票收益的**收益率模型**，以及如何利用模型预测进行**投资组合优化**以获取超额收益。我们将特别讨论组合优化中可能遇到的模型错位问题及其解决方法，并介绍常见的优化目标函数与约束条件。

## 1. 收益率模型：获取“阿尔法” [cite: 308]

### 1.1 基本术语澄清

* **预测变量 (Return Predictors):** 指那些能够预测股票未来收益率的变量，通常基于量价或财务数据。业界有时称之为“阿尔法因子”，但这与学术界对“因子”（定价因子或异象因子投资组合）和“阿尔法”（模型无法解释的超额收益）的定义不同。
* **术语:** 遵循学术界惯例，“因子”指投资组合，“阿尔法”指定价误差，用“预测变量”指代用于预测收益的指标。
* **预测变量来源:** 可以是因子变量（如BM，对应多因子模型中的$\beta'\lambda$部分）或异象变量（如IVOL，对应$\alpha$部分）。

### 1.2 寻找预测变量 [cite: 309]

* **发现新异象:** 从传统量价和财务数据中寻找新的、未被发现的规律。
* **改进已有变量:** 对现有变量的构造方法进行优化（如考虑研发费用的BM）或适应市场变化。
* **使用另类数据:** 探索如交易社区、微观数据、ESG、电商、卫星、气象等非传统数据源，寻找新的收益来源。

### 1.3 挑选预测变量的标准 [cite: 310]

一个理想的预测变量应满足六大标准：

1.  **逻辑性 (Intuitiveness):** 变量背后应有合理的经济学或金融学解释（风险补偿或错误定价），避免数据窥探。检验方法参见第6.5节。
2.  **持续性 (Persistence):** 实证数据应支持理论逻辑，变量需能持续预测收益。检验方法包括IC测试（信息系数）、投资组合排序法、发表前后检验等。
    * **IC (Information Coefficient):** $IC = corr(z_{it}, R_{it+1})$，衡量预测变量 $z_{it}$ 与下期收益 $R_{it+1}$ 的相关性。IC绝对值越高越好（日频>2%为优）。
    * **IR (Information Ratio):** $IR = \frac{mean(IC)}{std(IC)}$。
3.  **信息增量性 (Information Increasement):** 新变量相对已有变量应能提供额外的预测信息，避免冗余。检验方法包括变量相关性分析、条件排序法、Fama-MacBeth回归。可对预测变量进行行业、市值中性化处理以排除干扰。
4.  **稳健性 (Robustness):** 预测能力不应过度依赖特定的参数设定、算法或样本区间。从参数、算法、样本（分时间段、不同市场环境）等角度检验。
5.  **可投资性 (Investability):** 需考虑信息衰减速度（半衰期）、换手频率、交易成本（显性与隐性）、流动性、策略容量等现实约束。
6.  **普适性 (Pervasiveness):** 优秀的变量往往能在不同市场、不同资产类别中都有效（如价值、动量因子）。

### 1.4 收益率预测流程

1.  **确定投资范围:**
    * **原始股票池:** 如全市场、特定行业、指数成分股等。
    * **优化股票池 (剔除黑名单):** 剔除低流动性、高风险（ST、\*ST、待退市、净资产为负、次新股）、大概率跑输（如高换手率、高波动、估值高盈利差、有负面事件）的股票。
2.  **剔除预测变量异常值:**
    * 常用方法：缩尾法（Winsorization）、三倍标准差法、中位数绝对偏差法（MAD）。各有优劣，MAD相对稳健。
3.  **预测收益率:**
    * **非参数化预测:**
        * **条件选股法:** 根据多个指标设定阈值筛选股票，简单直接但可能持股不稳定、易过拟合。
        * **排序打分法:** 对各指标打分加总排序选股，选股数量可控，但未考虑变量权重差异。
    * **参数化预测 (线性回归):**
        * **变量标准化 (Z-Score):** $Z_{Score,k} = \frac{X_k - mean(X_k)}{std(X_k)}$。
        * **综合得分:** 可等权或按IC加权（$Z_{Score,i} = \sum_{k} \omega_k Z_{Score,k,i}$），建议分层处理（先维度内合成再维度间合成）。注意最终综合得分需再次标准化。
        * **回归预测:**
            * 方法一：每期截面回归 $R_{it} = c_t + b_t z_{it-1} + \epsilon_{it}$，用历史系数均值 $\bar{c}, \bar{b}$ 预测下期收益 $\hat{R}_{it+1} = \bar{c} + \bar{b} z_{it}$。
            * 方法二：面板回归估计系数 $\hat{c}, \hat{b}$，预测下期收益 $\hat{R}_{it+1} = \hat{c} + \hat{b} z_{it}$。
        * **与主动收益 $\alpha$ 的关系:** $\hat{\alpha}_{it} \approx IC \times \sigma_{\alpha} \times Z_{Score,i}$ (Grinold Alpha三要素公式)。

## 2. 投资组合优化 

### 2.1 收益与风险模型错位 (Misalignment) 

* **问题:** 当收益模型中的预测变量 (暴露 $\beta_{\alpha}$) 与风险模型中的因子 (暴露 $\beta_R$) 不一致时，会发生模型错位。常见于使用内部收益模型和第三方风险模型的情况。
* **影响:** 优化过程可能**低估**收益模型中**未被风险模型解释部分 ($\mu_{\perp}$)** 的风险，导致过度配置于这部分“伪阿尔法”，影响组合真实的风险收益特征。
    * 分解收益: $R_{\alpha} = \beta_{\alpha} \omega = \mu_{\parallel} + \mu_{\perp}$，其中 $\mu_{\parallel}$ 是能在风险因子空间解释的部分，$\mu_{\perp}$ 是不能解释的部分 ($\text{Cov}(\mu_{\perp}, \lambda_R) = 0$)。
    * 无约束优化解 $\omega^* \propto \Sigma^{-1} R_{\alpha}$。错位导致优化器认为 $\mu_{\perp}$ 风险仅为特质性风险 $\sigma_s^2 / \zeta$，而 $\mu_{\parallel}$ 的风险包含因子风险和特质性风险，从而对 $\mu_{\perp}$ 权重过高。
* **解决方法:**
    * **调整风险模型 (局限性大):** 剔除/替换风险因子，或构建新风险模型。不易操作，尤其对于商用模型。
    * **改进优化过程 (更优):** 在目标函数中加入对 $\mu_{\perp}$ 的额外惩罚项 $\theta \omega' \mu_{\perp} \mu_{\perp}' \omega$。惩罚系数 $\theta$ 应与 $\mu_{\perp}$ 的真实风险成正比。
* **现状:** 国内对此问题关注不足，需警惕其对优化结果的潜在影响。

### 2.2 常见目标函数 (假设模型无错位) 

令 $\mu$ 为超额收益预测，$\Sigma$ 为协方差矩阵。

1.  **均值-方差优化 (Mean-Variance Optimization, MVO):** 
    * 目标: $\max_{\omega} \omega' \mu - \frac{\zeta}{2} \omega' \Sigma \omega$。$\zeta$ 为风险厌恶系数。
    * 无约束解: $\omega_{mvo} = (\zeta \Sigma)^{-1} \mu$。
    * 优点: 理论最优，在风险和收益间权衡。
    * 缺点: 对输入参数 $\mu, \Sigma$ 高度敏感，尤其是 $\mu$ 难以准确预测。
2.  **最小方差 (Minimum Variance):** 
    * 目标: $\min_{\omega} \omega' \Sigma \omega$。
    * 最优解 (带 $\omega' \mathbf{1} = 1$ 约束): $\omega_{mv} \propto \Sigma^{-1} \mathbf{1}$。
    * 优点: 不依赖于 $\mu$ 的预测。
3.  **最大多样化 (Maximum Diversification):** 
    * 目标: $\max_{\omega} \frac{\omega' \sigma}{\sqrt{\omega' \Sigma \omega}}$，$\sigma$ 为个股波动率向量。
    * 最优解 (带 $\omega' \mathbf{1} = 1$ 约束): $\omega_{md} \propto \Sigma^{-1} \sigma$。
    * 优点: 追求组合内部风险的分散化。
4.  **风险平价 (Risk Parity / Equal Risk Contribution):** 
    * 目标: 使各资产对组合总风险的贡献相等，即 $\omega_i \frac{\partial \sigma_p}{\partial \omega_i} = \text{constant}$ for all i。$\sigma_p = \sqrt{\omega' \Sigma \omega}$。
    * 优化问题: $\min_{\omega} \sum_{i=1}^N \sum_{j=1}^N (\omega_i (\Sigma \omega)_i - \omega_j (\Sigma \omega)_j)^2$。
    * 特殊解析解 (若 $\rho_{ij} = \rho$ for $i \neq j$): $\omega_{rp,i} \propto 1 / \sigma_i$ (波动率倒数加权) 
    * 优点: 实现风险在各资产间的均衡分配，常用于大类资产配置。

### 2.3 不同目标函数的比较与等价条件 

* **等价于MVO的条件:** 
    * 最小方差: $\mu_i = \mu_j$ (所有资产预期收益相同)。
    * 最大多样化: $\mu_i / \sigma_i = \mu_j / \sigma_j$ (所有资产夏普比率相同)。
    * 风险平价: $\mu_i / \sigma_i = \mu_j / \sigma_j$ 且 $\rho_{ij} = \rho$ (夏普比率相同且相关系数相同)。
    * 等权重: $\mu_i / \sigma_i = \mu_j / \sigma_j$ 且 $\rho_{ij} = \rho$ 且 $\sigma_i = \sigma_j$ (夏普比率、相关系数、波动率均相同)。
* **启示:** 对参数的假设决定了最优配置方法。若无可靠信息，等权重可能是稳健的选择；若有可靠信息（如协方差），应选择更优化的方法。

### 2.4 常见约束条件 

为满足实际投资需求和风控要求，优化时常加入约束：

1.  **卖空约束:** $\omega \ge 0$ 
2.  **杠杆约束 (满仓):** $\omega' \mathbf{1} = 1$ 
3.  **头寸上下限约束:** $L \le \omega \le U$ (个股)；$l_p \le \sum_{i \in I_p} \omega_i \le u_p$ (行业/板块)；或行业中性 $H \omega = h$ 
4.  **换手率约束:** $|\omega_i - \omega^-_i| \le \phi_i$ (个股)；$\sum_i |\omega_i - \omega^-_i| \le \Phi$ (组合整体) 
5.  **持仓数量约束:** $N_L \le \sum_i \delta_i \le N_U$，$\delta_i$ 为0/1持仓哑变量 
6.  **因子暴露约束:** $l_k \le \sum_i \omega_i \beta_{ik} \le u_k$ (绝对暴露)；或 $l_k \le \sum_i (\omega_i - \omega_{Bi}) \beta_{ik} \le u_k$ (主动暴露，可实现风格中性) 
7.  **跟踪误差约束:** $(\omega - \omega_B)' \Sigma (\omega - \omega_B) \le \sigma^2_{TE}$ 

* 加入约束后通常需要数值方法求解，需注意约束间的冲突和无解可能 

### 2.5 交易成本模型 

* 将交易成本作为惩罚项加入目标函数：$\max_{\omega} f(\mu, \Sigma, \theta, \omega) - \gamma_{TC} TC(\omega)$ 
* **线性成本函数:** $TC(\omega) = \sum_i c_i |\omega_i - \omega^-_i|$ 
* **二次成本函数:** $TC(\omega) = \sum_i c_i |\omega_i - \omega^-_i| + \sum_i d_i (\omega_i - \omega^-_i)^2$ (考虑冲击成本) 